<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>水文 - 一个容错率较高GBA模拟器的实现 - 闲言碎语 -  ISO/IEC C++ China Unofficial -  Powered by Discuz!</title>
<link href="thread-17333-1-1.html" rel="canonical" />
<meta name="keywords" content="水文 - 一个容错率较高GBA模拟器的实现" />
<meta name="description" content="之前貌似写过一篇关于FC模拟器的漏文, 之后搁置原因: 当时是写模拟器的时候水平处于一个完全不开化的状态      : 貌似别的模拟器更有意思       : NES真的麻烦, 扩展设 ... 水文 - 一个容错率较高GBA模拟器的实现 ,ISO/IEC C++ China Unofficial" />
<meta name="generator" content="Discuz! X3.4" />
<meta name="author" content="Discuz! Team and Comsenz UI Team" />
<meta name="copyright" content="2001-2020 Tencent Cloud." />
<meta name="MSSmartTagsPreventParsing" content="True" />
<meta http-equiv="MSThemeCompatible" content="Yes" />
<base href="https://cpp<!--.ra2diy.com/" />--><link rel="stylesheet" type="text/css" href="https://cpp.ra2diy.com/data/cache/style_1_common.css?W6u" /><link rel="stylesheet" type="text/css" href="https://cpp.ra2diy.com/data/cache/style_1_forum_viewthread.css?W6u" /><link rel="stylesheet" id="css_extstyle" type="text/css" href="https://cpp.ra2diy.com/template/default/style/t5/style.css" /><script type="text/javascript">var STYLEID = '1', STATICURL = 'static/', IMGDIR = 'static/image/common', VERHASH = 'W6u', charset = 'utf-8', discuz_uid = '0', cookiepre = 'ijbZ_2132_', cookiedomain = '', cookiepath = '/', showusercard = '1', attackevasive = '0', disallowfloat = 'newthread', creditnotice = '1|威望|,2|经验|,3|贡献|', defaultstyle = './template/default/style/t5', REPORTURL = 'aHR0cHM6Ly9jcHAucmEyZGl5LmNvbS90aHJlYWQtMTczMzMtMS0xLmh0bWw=', SITEURL = 'https://cpp.ra2diy.com/', JSPATH = 'data/cache/', CSSPATH = 'data/cache/style_', DYNAMICURL = '';</script>
<script src="https://cpp.ra2diy.com/data/cache/common.js?W6u" type="text/javascript"></script>
<meta name="application-name" content="ISO/IEC C++ China Unofficial" />
<meta name="msapplication-tooltip" content="ISO/IEC C++ China Unofficial" />
<meta name="msapplication-task" content="name=论坛;action-uri=https://cpp.ra2diy.com/forum.php;icon-uri=https://cpp.ra2diy.com/static/image/common/bbs.ico" />
<link rel="archives" title="ISO/IEC C++ China Unofficial" href="https://cpp.ra2diy.com/archiver/" />
<script src="https://cpp.ra2diy.com/data/cache/forum.js?W6u" type="text/javascript"></script>
</head>

<body id="nv_forum" class="pg_viewthread" onkeydown="if(event.keyCode==27) return false;">
<div id="append_parent"></div><div id="ajaxwaitid"></div>
<div id="toptb" class="cl">
<div class="wp">
<div class="z"><a href="javascript:;"  onclick="setHomepage('http://cpp.ra2diy.com/');">设为首页</a><a href="http://cpp.ra2diy.com/"  onclick="addFavorite(this.href, 'ISO/IEC C++ China Unofficial');return false;">收藏本站</a></div>
<div class="y">
<a id="switchblind" href="javascript:;" onclick="toggleBlind(this)" title="开启辅助访问" class="switchblind">开启辅助访问</a>
<a href="javascript:;" id="switchwidth" onclick="widthauto(this)" title="切换到宽版" class="switchwidth">切换到宽版</a>
</div>
</div>
</div>

<div id="qmenu_menu" class="p_pop blk" style="display: none;">
<div class="ptm pbw hm">
请 <a href="javascript:;" class="xi2" onclick="lsSubmit()"><strong>登录</strong></a> 后使用快捷导航<br />没有帐号？<a href="https://cpp.ra2diy.com/member.php?mod=register" class="xi2 xw1">立即注册</a>
</div>
<div id="fjump_menu" class="btda"></div></div><div id="hd">
<div class="wp">
<div class="hdc cl"><h2><a href="https://cpp.ra2diy.com/" title="ISO/IEC C++ China Unofficial"><img src="https://cpp.ra2diy.com/static/image/common/logo.png" alt="ISO/IEC C++ China Unofficial" border="0" /></a></h2><script src="https://cpp.ra2diy.com/data/cache/logging.js?W6u" type="text/javascript"></script>
<form method="post" autocomplete="off" id="lsform" action="member.php?mod=logging&amp;action=login&amp;loginsubmit=yes&amp;infloat=yes&amp;lssubmit=yes" onsubmit="pwmd5('ls_password');return lsSubmit();">
<div class="fastlg cl">
<span id="return_ls" style="display:none"></span>
<div class="y pns">
<table cellspacing="0" cellpadding="0">
<tr>
<td>
<span class="ftid">
<select name="fastloginfield" id="ls_fastloginfield" width="40" tabindex="900">
<option value="username">用户名</option>
<option value="uid">UID</option>
<option value="email">Email</option>
</select>
</span>
<script type="text/javascript">simulateSelect('ls_fastloginfield')</script>
</td>
<td><input type="text" name="username" id="ls_username" autocomplete="off" class="px vm" tabindex="901" /></td>
<td class="fastlg_l"><label for="ls_cookietime"><input type="checkbox" name="cookietime" id="ls_cookietime" class="pc" value="2592000" tabindex="903" />自动登录</label></td>
<td>&nbsp;<a href="javascript:;" onclick="showWindow('login', 'member.php?mod=logging&action=login&viewlostpw=1')">找回密码</a></td>
</tr>
<tr>
<td><label for="ls_password" class="z psw_w">密码</label></td>
<td><input type="password" name="password" id="ls_password" class="px vm" autocomplete="off" tabindex="902" /></td>
<td class="fastlg_l"><button type="submit" class="pn vm" tabindex="904" style="width: 75px;"><em>登录</em></button></td>
<td>&nbsp;<a href="https://cpp.ra2diy.com/member.php?mod=register" class="xi2 xw1">立即注册</a></td>
</tr>
</table>
<input type="hidden" name="quickforward" value="yes" />
<input type="hidden" name="handlekey" value="ls" />
</div>
</div>
</form>

<script src="https://cpp.ra2diy.com/data/cache/md5.js?W6u" type="text/javascript" reload="1"></script>
</div>

<div id="nv">
<a href="javascript:;" id="qmenu" onmouseover="delayShow(this, function () {showMenu({'ctrlid':'qmenu','pos':'34!','ctrlclass':'a','duration':2});showForummenu(49);})">快捷导航</a>
<ul><li class="a" id="mn_forum" ><a href="http://cpp.ra2diy.com/forum.php" hidefocus="true" title="BBS"  >论坛<span>BBS</span></a></li><li id="mn_Ne008" ><a href="https://cpp.ra2diy.com/search.php" hidefocus="true"  >搜索</a></li><li id="mn_N0a2c" ><a href="https://cpp.ra2diy.com/misc.php?mod=faq" hidefocus="true" title="Help"  >帮助<span>Help</span></a></li></ul>
</div>
<div id="mu" class="cl">
</div><div id="scbar" class="cl">
<form id="scbar_form" method="post" autocomplete="off" onsubmit="searchFocus($('scbar_txt'))" action="search.php?searchsubmit=yes" target="_blank">
<input type="hidden" name="mod" id="scbar_mod" value="search" />
<input type="hidden" name="formhash" value="babe254c" />
<input type="hidden" name="srchtype" value="title" />
<input type="hidden" name="srhfid" value="49" />
<input type="hidden" name="srhlocality" value="forum::viewthread" />
<table cellspacing="0" cellpadding="0">
<tr>
<td class="scbar_icon_td"></td>
<td class="scbar_txt_td"><input type="text" name="srchtxt" id="scbar_txt" value="请输入搜索内容" autocomplete="off" x-webkit-speech speech /></td>
<td class="scbar_type_td"><a href="javascript:;" id="scbar_type" class="xg1" onclick="showMenu(this.id)" hidefocus="true">搜索</a></td>
<td class="scbar_btn_td"><button type="submit" name="searchsubmit" id="scbar_btn" sc="1" class="pn pnc" value="true"><strong class="xi2">搜索</strong></button></td>
<td class="scbar_hot_td">
<div id="scbar_hot">
</div>
</td>
</tr>
</table>
</form>
</div>
<ul id="scbar_type_menu" class="p_pop" style="display: none;"><li><a href="javascript:;" rel="curforum" fid="49" >本版</a></li><li><a href="javascript:;" rel="forum" class="curtype">帖子</a></li><li><a href="javascript:;" rel="user">用户</a></li></ul>
<script type="text/javascript">
initSearchmenu('scbar', '');
</script>
</div>
</div>


<div id="wp" class="wp">
<script type="text/javascript">var fid = parseInt('49'), tid = parseInt('17333');</script>

<script src="https://cpp.ra2diy.com/data/cache/forum_viewthread.js?W6u" type="text/javascript"></script>
<script type="text/javascript">zoomstatus = parseInt(1);var imagemaxwidth = '600';var aimgcount = new Array();</script>

<style id="diy_style" type="text/css"></style>
<!--[diy=diynavtop]--><div id="diynavtop" class="area"></div><!--[/diy]-->
<div id="pt" class="bm cl">
<div class="z">
<a href="https://cpp.ra2diy.com/" class="nvhm" title="首页">ISO/IEC C++ China Unofficial</a><em>&raquo;</em><a href="http://cpp.ra2diy.com/forum.php">论坛</a> <em>&rsaquo;</em> <a href="http://cpp.ra2diy.com/forum.php?gid=40">车水马龙</a> <em>&rsaquo;</em> <a href="http://cpp.ra2diy.com/forum-49-1.html">闲言碎语</a> <em>&rsaquo;</em> <a href="http://cpp.ra2diy.com/thread-17333-1-1.html">水文 - 一个容错率较高GBA模拟器的实现</a>
</div>
</div>

<style id="diy_style" type="text/css"></style>
<div class="wp">
<!--[diy=diy1]--><div id="diy1" class="area"></div><!--[/diy]-->
</div>

<div id="ct" class="wp cl">
<div id="pgt" class="pgs mbm cl ">
<div class="pgt"><div class="pg"><strong>1</strong><a href="http://cpp.ra2diy.com/thread-17333-2-1.html">2</a><label><input type="text" name="custompage" class="px" size="2" title="输入页码，按回车快速跳转" value="1" onkeydown="if(event.keyCode==13) {window.location='forum.php?mod=viewthread&tid=17333&amp;extra=page%3D1&amp;page='+this.value;; doane(event);}" /><span title="共 2 页"> / 2 页</span></label><a href="http://cpp.ra2diy.com/thread-17333-2-1.html" class="nxt">下一页</a></div></div>
<span class="y pgb" id="visitedforums" onmouseover="$('visitedforums').id = 'visitedforumstmp';this.id = 'visitedforums';showMenu({'ctrlid':this.id,'pos':'34'})"><a href="http://cpp.ra2diy.com/forum-49-1.html">返回列表</a></span>
<a id="newspecial" onmouseover="$('newspecial').id = 'newspecialtmp';this.id = 'newspecial';showMenu({'ctrlid':this.id})" onclick="showWindow('newthread', 'forum.php?mod=post&action=newthread&fid=49')" href="javascript:;" title="发新帖"><img src="https://cpp.ra2diy.com/static/image/common/pn_post.png" alt="发新帖" /></a></div>



<div id="postlist" class="pl bm">
<table cellspacing="0" cellpadding="0">
<tr>
<td class="pls ptn pbn">
<div class="hm ptn">
<span class="xg1">查看:</span> <span class="xi1">1614</span><span class="pipe">|</span><span class="xg1">回复:</span> <span class="xi1">31</span>
</div>
</td>
<td class="plc ptm pbn vwthd">
<div class="y">
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&action=printable&tid=17333" title="打印" target="_blank"><img src="https://cpp.ra2diy.com/static/image/common/print.png" alt="打印" class="vm" /></a>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=nextoldset&tid=17333" title="上一主题"><img src="https://cpp.ra2diy.com/static/image/common/thread-prev.png" alt="上一主题" class="vm" /></a>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=nextnewset&tid=17333" title="下一主题"><img src="https://cpp.ra2diy.com/static/image/common/thread-next.png" alt="下一主题" class="vm" /></a>
</div>
<h1 class="ts">
<span id="thread_subject">水文 - 一个容错率较高GBA模拟器的实现</span>
</h1>
<span class="xg1">
<a href="http://cpp.ra2diy.com/thread-17333-1-1.html" onclick="return copyThreadUrl(this, 'ISO/IEC C++ China Unofficial')" >[复制链接]</a>
</span>
</td>
</tr>
</table>


<table cellspacing="0" cellpadding="0" class="ad">
<tr>
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table><div id="post_17674" ><table id="pid17674" class="plhin" summary="pid17674" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17674" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17674" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17674_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17674')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17674" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17674_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17674" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17674_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17674_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17674&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<div id="fj" class="y">
<label class="z">电梯直达</label>
<input type="text" class="px p_fre z" size="2" onkeyup="$('fj_btn').href='forum.php?mod=redirect&ptid=17333&authorid=0&postno='+this.value" onkeydown="if(event.keyCode==13) {window.location=$('fj_btn').href;return false;}" title="跳转到指定楼层" />
<a href="javascript:;" id="fj_btn" class="z" title="跳转到指定楼层"><img src="https://cpp.ra2diy.com/static/image/common/fj_btn.png" alt="跳转到指定楼层" class="vm" /></a>
</div>
<strong>
<a href="http://cpp.ra2diy.com/thread-17333-1-1.html"   id="postnum17674" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
楼主</a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17674" src="https://cpp.ra2diy.com/static/image/common/online_member.gif" />
<em id="authorposton17674">发表于 2019-6-27 10:31:40</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
<span class="none"><img src="https://cpp.ra2diy.com/static/image/common/arw_r.gif" class="vm" alt="回帖奖励" /></span>
<span class="pipe show">|</span><a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&extra=page=1&ordertype=1"  class="show">倒序浏览</a>
<span class="pipe show">|</span><a href="javascript:;" onclick="readmode($('thread_subject').innerHTML, 17674);" class="show">阅读模式</a>
</div>
</div>
</div><div class="pct"><style type="text/css">.pcb{margin-right:0}</style><div class="pcb">
 
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17674">
之前貌似写过一篇关于FC模拟器的漏文, 之后搁置<br />
原因: 当时是写模拟器的时候水平处于一个完全不开化的状态<br />
&nbsp; &nbsp;&nbsp; &nbsp;: 貌似别的模拟器更有意思 <br />
&nbsp; &nbsp;&nbsp; &nbsp;: NES真的麻烦, 扩展设备乱七八糟, 特别是音频芯片, 可能会比较难写, 我真是怕了<br />
&nbsp; &nbsp;&nbsp; &nbsp;: 知乎某人已经写过了, 写的比我好得多, 珠玉在前, 就不继续献丑了<br />
&nbsp; &nbsp;&nbsp; &nbsp;: 准备写这篇文章的这个程序我已经完成了60%了, 不慌, 可以慢慢写 应该能做到有始有终(?)<br />
<br />
这篇文章大部分内容和思想, 方法来自以下 -<br />
GBATEK <a href="http://problemkaputt.de/gbatek.htm" target="_blank">http://problemkaputt.de/gbatek.htm</a><br />
GBA Programming Manual v1.1.pdf 南美任天堂官方手册, 有兴趣可以自己搜索下载pdf<br />
Jonathan Harbour - Programming GBA.pdf 市面唯一一部出售的关于GBA编程的书籍 <br />
tonc.pdf <a href="http://coranac.com/tonc/text/" target="_blank">http://coranac.com/tonc/text/</a><br />
arm_arm.pdf <a href="https://www.scss.tcd.ie/~waldroj/3d1/arm_arm.pdf" target="_blank">https://www.scss.tcd.ie/~waldroj/3d1/arm_arm.pdf</a><br />
DDI0210B.pdf <a href="http://infocenter.arm.com/help/topic/com.arm.doc.ddi0210c/DDI0210B.pdf" target="_blank">http://infocenter.arm.com/help/topic/com.arm.doc.ddi0210c/DDI0210B.pdf</a><br />
CowBiteSpec <a href="https://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#OAM%20(sprites)" target="_blank">https://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#OAM%20(sprites)</a><br />
DUI0068.pdf <a href="http://infocenter.arm.com/help/topic/com.arm.doc.dui0068b/DUI0068.pdf" target="_blank">http://infocenter.arm.com/help/topic/com.arm.doc.dui0068b/DUI0068.pdf</a><br />
VBA, VBA-M, mGBA 以及其他不知名开源模拟器的源代码 <br />
有兴趣可以直接去看原文/源码<br />
<br />
前置知识 - <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;稍微的操作系统的知识, 了解中断是个啥..<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;稍微的c语言编程, 有c++和汇编更好<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;稍微的信号处理知识, 会写简单的可调属性(频率, 占空比)的方波发生器就行了<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;稍微的图形处理知识, 线性代数以及会调用一些简单的平台blit贴图知识即可<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;稍微懂点就行了, 因为我也只是稍微懂点<br />
<br />
狗屁说完, 开始正文 <br />
<br />
<br />
</td></tr></table>


</div>
<div id="comment_17674" class="cm">
</div>

<div id="post_rate_div_17674"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div id="p_btn" class="mtw mbm hm cl">

<a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=favorite&type=thread&id=17333&formhash=babe254c" id="k_favorite" onclick="showWindow(this.id, this.href, 'get', 0);" onmouseover="this.title = $('favoritenumber').innerHTML + ' 人收藏'" title="收藏本帖"><i><img src="https://cpp.ra2diy.com/static/image/common/fav.gif" alt="收藏" />收藏<span id="favoritenumber" style="display:none">0</span></i></a>
</div>
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17674"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&reppost=17674&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17674" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17674', 'misc.php?mod=report&rtype=post&rid=17674&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17674_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17674')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17675" ><table id="pid17675" class="plhin" summary="pid17675" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17675" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17675" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17675_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17675')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17675" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17675_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17675" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17675_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17675_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17675&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17675"   id="postnum17675" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
沙发</a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17675" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17675">发表于 2019-6-27 10:53:59</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17675">
<i class="pstatus"> 本帖最后由 moecmks 于 2019-6-27 10:59 编辑 </i><br />
<br />
就不扯什么乱七八糟的历史了<br />
GBA的关于GBA渲染工作的原件包括如下几个大元件<br />
<br />
CPU&nbsp; &nbsp;-&nbsp; &nbsp; ARM7TDMI, ARM v4t 版本的芯片<br />
GPU&nbsp; &nbsp;-&nbsp; &nbsp; 没名字,以后就叫他 AGB-GPU <br />
APU&nbsp; &nbsp;-&nbsp; &nbsp; 没名字,以后就叫他 AGB-APU<br />
DMA&nbsp; &nbsp;-&nbsp; &nbsp; 快速设备拷存, 4个,每一个都有一种可被用作特殊用途的用法 (GPU光栅操作, 以及配合定时器进行音频传输)<br />
TIMER&nbsp; &nbsp;-&nbsp; &nbsp; 定时器, 也是4个 <br />
RS串口&nbsp; &nbsp;-&nbsp; &nbsp; 暂时不讲, 因为现在很少有人联网玩GBA游戏了<br />
输入控制器&nbsp; &nbsp;-&nbsp; &nbsp; 就是那几个按钮, ABLR 方向键, 开始选择 <br />
GammPAK卡带以及外围设备&nbsp; &nbsp;-&nbsp; &nbsp;&nbsp;&nbsp;(EEPROM, FLASH 以及RTC, 光学传感器等)<br />
BIOS<br />
<br />
一个个讲, 在此之前说一下GBA的内存布局 <br />
GBA可寻址到28位的地址空间(0~0x10000000)<br />
<br />
<font color="#ff0000">00000000-01FFFFFF</font> - BIOS, 总线宽度32位, 这部分前32K是BIOS程序的放置处, 注意BIOS不可写. 32K往上读将读不到数据.<br />
<br />
<font color="#ff0000">02000000-02FFFFFF</font> - 256K RAM 总线宽度32位, 衔接在主板上的256K内存, 他的读写性能要比卡带内存好一点(常规).<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;读写前256K这部分区域外的地址会被镜像到256K内存内. (addr &amp;= 0x3FFFF)<br />
<br />
<font color="#ff0000">03000000-03FFFFFF</font> - 32K RAM 总线宽度32位, 芯片内部的32K内存, 他的读写性能是最好的, 很多时候卡带会把代码拷贝到此内存执行..<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;读写前32K这部分区域外的地址会被镜像到32K内存内. (addr &amp;= 0x7FFF)<br />
<br />
<font color="#ff0000">04000000-04FFFFFF</font> - 内存IO 总线宽度32位, 芯片内部的内存IO空间(前1K空间有数据, 以及少部分IO在2K之内), <br />
&nbsp; &nbsp;&nbsp; &nbsp; 此处只有一个特殊镜像, 以后会说明. <br />
<br />
<font color="#ff0000">05000000-05FFFFFF</font> - BG/SP调色板 总线宽度16位, 前1K为有效数据, 读写之后超出范围的地址会被镜像 (addr &amp;= 0x3FF)<br />
&nbsp; &nbsp;&nbsp; &nbsp; 前512字节为BG调色板, 后512字节为SP调色板<br />
<br />
<font color="#ff0000">06000000-06FFFFFF</font> - GPU显存 总线宽度16位, 前96K为有效数据, 通常而言前64K给卷轴用, 后32K给精灵用<br />
&nbsp; &nbsp;&nbsp; &nbsp;读写之后超出范围的地址会被镜像, 这部分镜像不是单纯的线性镜像映射 <br />
<br />
首先每0x20000镜像一次, <br />
在这0x20000里面, 前0x17FFF都是镜像0x06000000 ~ 0x06017FFF, <br />
最后这32K映射镜像灵 0x06010000~0x06017FFF<br />
如图----------------------------------------------------------------------------------------------------------------------<br />
0x00000 | 0x08000 | 0x10000&nbsp; &nbsp;&nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0x18000&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;|&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0x20000<br />
--------------------------------------------------------------------------------------------------------------------------<br />
0x20000 | 0~0xFFFF&nbsp; &nbsp;&nbsp; &nbsp;64K Bg卷轴&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;|&nbsp;&nbsp;0x10000~0x17FFF 32K精灵&nbsp; &nbsp;&nbsp; &nbsp;|&nbsp; &nbsp;0x18000 ~ 0x1FFFF 32K精灵镜像<br />
--------------------------------------------------------------------------------------------------------------------------<br />
0x20000 | 0~0xFFFF&nbsp; &nbsp;&nbsp; &nbsp;64K Bg卷轴&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;|&nbsp;&nbsp;0x10000~0x17FFF 32K精灵&nbsp; &nbsp;&nbsp; &nbsp;|&nbsp; &nbsp;0x18000 ~ 0x1FFFF 32K精灵镜像<br />
--------------------------------------------------------------------------------------------------------------------------<br />
0x20000 | 0~0xFFFF&nbsp; &nbsp;&nbsp; &nbsp;64K Bg卷轴&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;|&nbsp;&nbsp;0x10000~0x17FFF 32K精灵&nbsp; &nbsp;&nbsp; &nbsp;|&nbsp; &nbsp;0x18000 ~ 0x1FFFF 32K精灵镜像<br />
--------------------------------------------------------------------------------------------------------------------------<br />
0x20000 | 0~0xFFFF&nbsp; &nbsp;&nbsp; &nbsp;64K Bg卷轴&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;|&nbsp;&nbsp;0x10000~0x17FFF 32K精灵&nbsp; &nbsp;&nbsp; &nbsp;|&nbsp; &nbsp;0x18000 ~ 0x1FFFF 32K精灵镜像<br />
--------------------------------------------------------------------------------------------------------------------------<br />
0x20000 | 0~0xFFFF&nbsp; &nbsp;&nbsp; &nbsp;64K Bg卷轴&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;|&nbsp;&nbsp;0x10000~0x17FFF 32K精灵&nbsp; &nbsp;&nbsp; &nbsp;|&nbsp; &nbsp;0x18000 ~ 0x1FFFF 32K精灵镜像<br />
--------------------------------------------------------------------------------------------------------------------------<br />
<br />
<font color="#ff0000">07000000-07FFFFFF</font> - 精灵属性内存 总线宽度32位, 前1K为有效数据, 读写之后超出范围的地址会被镜像 (addr &amp;= 0x3FF)<br />
<font color="#ff0000">08000000-09FFFFFF</font> - GBA卡带内存 总线宽度16位 - Wait State 0<br />
<font color="#ff0000">0A000000-0BFFFFFF</font> - GBA卡带内存 总线宽度16位 - Wait State 1<br />
<font color="#ff0000">0C000000-0DFFFFFF</font> - GBA卡带内存 总线宽度16位 - Wait State 2<br />
<br />
这三部分的32MB内存读写的都是一样的数据, 常规状态不可写, 对于Flash卡带, EEPROM 是可写的 (跟NES的mapper类似)<br />
其中区别在于后面的Wait State, <br />
每部分区域的WaitState状态都可以被设置, (其中最主要的用途是用来访问慢速设备).....<br />
<br />
<font color="#ff0000">0E000000-0FFFFFFF</font> 电池, 总线宽度为8位, 前64K有效, 读写之后的做镜像, 卡带的SRAM, 主要用来保存数据/存档<br />
</td></tr></table>


</div>
<div id="comment_17675" class="cm">
</div>

<div id="post_rate_div_17675"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17675"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17675&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17675&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17675').innerHTML ? $('review_support_17675').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17675"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17675&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17675').innerHTML ? $('review_against_17675').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17675"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17675" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17675', 'misc.php?mod=report&rtype=post&rid=17675&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17675_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17675')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17676" ><table id="pid17676" class="plhin" summary="pid17676" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17676" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17676" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17676_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17676')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17676" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17676_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17676" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17676_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17676_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17676&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17676"   id="postnum17676" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
板凳</a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17676" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17676">发表于 2019-6-27 11:08:19</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17676">
<i class="pstatus"> 本帖最后由 moecmks 于 2019-6-27 11:18 编辑 </i><br />
<br />
<font color="Red">---------------------------------------------------------CPU概览---------------------------------------------------------------------</font></td></tr></table>


</div>
<div id="comment_17676" class="cm">
</div>

<div id="post_rate_div_17676"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17676"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17676&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17676&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17676').innerHTML ? $('review_support_17676').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17676"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17676&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17676').innerHTML ? $('review_against_17676').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17676"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17676" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17676', 'misc.php?mod=report&rtype=post&rid=17676&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17676_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17676')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17677" ><table id="pid17677" class="plhin" summary="pid17677" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17677" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17677" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17677_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17677')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17677" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17677_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17677" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17677_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17677_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17677&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17677"   id="postnum17677" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
地板</a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17677" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17677">发表于 2019-6-27 11:09:05</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17677">
<i class="pstatus"> 本帖最后由 moecmks 于 2019-6-27 11:15 编辑 </i><br />
<br />
GBA有两颗CPU核心<br />
一颗ARM7TDMI芯片, 32位RISC芯片, 主频率 16.78MHZ,<br />
一颗Z80改版夏普LR35902芯片常态频率 4.19MHZ, 可变频至8.38MHZ<br />
LR35902芯片是辅助芯片, 主要用来兼容GBC/GB游戏解<br />
<br />
ARM7TDMI是一块很有趣的芯片,<br />
<br />
{ ====== 跟主流的X86等CISC芯片相比有如下&quot;特点&quot; . =========== }<br />
1. &lt;通用寄存器的增加&gt;<br />
2. &lt;ALU指令不访存, 读写内存需要专门的指令&gt;<br />
3. &lt;ALU可以同时计算和移位&gt;<br />
4. &lt;同时存在两套独立的指令集, 常规ARM7指令集和THUMB指令集&gt;<br />
5. &lt;未对齐的访存可能出现异常行为&gt;<br />
<br />
{ ====== ARM7TDMI使用的数据类型 (数据类型跟主流的x86不太一样). ======== }<br />
字(WORD):32位数据类型, uint32_t/int32_t<br />
半字(HALFWORD):16位数据类型, uint16_t/int16_t<br />
字节(BYTE):8位数据类型, uint8_t/int8_t<br />
在ARM7TDMI中, 所有的寄存器都是32位的,<br />
所有的ALU也大多只有32位的操作<br />
<br />
{ ====== ARM7TDMI中的内存对齐 ======== }<br />
在ARM7中,<br />
Word基于4字节对齐,<br />
HalfWord基于2字节对齐,<br />
Byte不需要对齐<br />
对齐的既是数据, 也是指令<br />
ARM7指令基于4字节对齐,<br />
Thumb指令基于2字节对齐.<br />
未对齐的访问基本算是UB行为, 这部分UB行为有些会有很奇怪但是游戏会利用的feature..<br />
<br />
{ ====== GBA使用小端格式 ======== }<br />
所以所有讨论都是基于小端.<br />
你可能需要点基本的ARM7编程知识,<br />
和一些简单的C语言/计算机底层知识(比如汇编...emmm..) 的才能看懂CPU的部分内容<br />
<br />
{ ====== 寄存器/中断/Thumb, ARM7指令 概览======== }<br />
&nbsp; &nbsp; (*&nbsp;&nbsp;寄存器***)<br />
&nbsp; &nbsp; (*&nbsp; &nbsp;---------- *)<br />
&nbsp; &nbsp;&nbsp; &nbsp;能同时被使用的有r0-r15, 还有一个CPSR, 如果在非系统/用户模式下还有一个SPSR寄存器<br />
&nbsp; &nbsp;&nbsp; &nbsp;在这些寄存器中,<br />
&nbsp; &nbsp;&nbsp; &nbsp;部分寄存器全模式下只有一份, 比如(r0-r7, r15和CPSR)<br />
&nbsp; &nbsp;&nbsp; &nbsp;部分寄存器在每个不同模式可能会有一份独立的寄存器, 此时使用寄存器就是当前模式下的寄存器<br />
&nbsp; &nbsp;&nbsp; &nbsp;比如在管理模式你用r13就是管理模式的r13, 在用户模式, 你用的就是用户模式下的r13,<br />
&nbsp; &nbsp;&nbsp; &nbsp;同名寄存器在不同模式是相互独立的寄存器 (如果此模式存在备份寄存器的情况下...)<br />
&nbsp; &nbsp;&nbsp; &nbsp;这些寄存器都是32位的<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;r0-r7: 这八个寄存器全模式都只有一份, 独一无二的杂鱼寄存器.没什么特别用处, 基本是编程控制计算使用的主力寄存器<br />
&nbsp; &nbsp;&nbsp; &nbsp;r8-r12: 这五个寄存器除了快速中断模式(FIQ)有一份独立的寄存器, 其余模式共享一份r8-r12, <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;这是为了快速中断特意扩展的保持寄存器集, 然而GBA不适用FIQ模式,<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;好像许多ARM下的操作系统也不支持这中断模式, 所以除了FIQ外, 其余模式下此寄存器集的性质等同于r0-r7<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;r13-r14: 这两个寄存器每个模式都有一份独立的寄存器,<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;r13是栈指针, <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;r14是调用返回寄存器 (LR LINK)<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;r15: 也就是PC程序指针, 独一份<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR: 独一份<br />
&nbsp; &nbsp;&nbsp; &nbsp;SPSR: 除了系统/用户模式, 之外的模式都有独立的SPSR寄存器<br />
<br />
&nbsp; &nbsp; (*&nbsp;&nbsp;调用返回寄存器r14 (LR LINK)*********)<br />
&nbsp; &nbsp; (*----------*_*)<br />
&nbsp; &nbsp;&nbsp; &nbsp;大家应该多少懂点C语言的函数调用8?<br />
&nbsp; &nbsp;&nbsp; &nbsp;比如这个简单大家都知道的MessageBoxA 函数<br />
&nbsp; &nbsp;&nbsp; &nbsp;反汇编成x86<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;push MB_OK<br />
&nbsp; &nbsp;&nbsp; &nbsp;push &quot;Hello World&quot;<br />
&nbsp; &nbsp;&nbsp; &nbsp;push &quot;Win32SDK&quot;<br />
&nbsp; &nbsp;&nbsp; &nbsp;push nullptr<br />
&nbsp; &nbsp;&nbsp; &nbsp;call MessageBoxA<br />
&nbsp; &nbsp;&nbsp; &nbsp;cmp eax, 32<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;这个call调用会把下一条指令的地址 (cmp eax, 32)轧入栈中<br />
&nbsp; &nbsp;&nbsp; &nbsp;过程结束后再ret 弹栈恢复PC 返回到 cmp eax, 32 执行<br />
&nbsp; &nbsp;&nbsp; &nbsp;而ARM7不会把下一条指令轧入栈中, 而是保持在 r14中<br />
&nbsp; &nbsp;&nbsp; &nbsp;r14基本就是起上述例子相等的作用<br />
&nbsp; &nbsp;&nbsp; &nbsp;除了方便外, 另一个用这条指令的理由是流水线的执行会导致你手动计算很难取到\<br />
&nbsp; &nbsp;&nbsp; &nbsp;当前指令导致的下一条指令地址, 比如在ARM7,<br />
&nbsp; &nbsp;&nbsp; &nbsp;由于流水线的关系, 你在执行当前指令的时候实际PC以及指向了下面两条指令的地址处了<br />
&nbsp; &nbsp;&nbsp; &nbsp;不同版本可能会有不同的流水线指令偏移, 这么写方便在各种不同版本共用取址,<br />
<br />
&nbsp; &nbsp; (*&nbsp;&nbsp;CPSR/ SPSR (程序控制状态寄存器)*********)<br />
&nbsp; &nbsp; (*----------*_*)<br />
&nbsp; &nbsp;&nbsp; &nbsp;SPSR是CPSR的备份, 在中断发生处理器切换模式时, CPSR会自动拷贝到前往模式的SPSR中<br />
&nbsp; &nbsp;&nbsp; &nbsp;在ARM7中, CPSR的32位根据功能不同被分为不同的位域<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;d0-d4:&nbsp; &nbsp;&nbsp; &nbsp;这五位用来指示当前所处的模式, 共7种,<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;10000 用户模式 (USER)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;10001 快速中断模式 (FIQ)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;10010 中断模式 (IRQ)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;10011 管理模式 (Supervisor)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;10111 中止模式 (Abort)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;11011 未定义模式 (Undef)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;11111 系统模式 (System)<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;FIQ, IRQ都很蛤理解, 管理模式是使用软件中断SWI指令/芯片重启可以进入<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;未定义模式当执行到没有被定义的机器码的时候会触发该中断(异常)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;中止模式用于访问到无效的内存地址和未对齐的地址(指令地址/内存地址)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;在特权模式下, 也可以手动使用指令切换模式<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;注意在系统/用户模式下是没有SPSR的<br />
<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;d5:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;thumb标志<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;此标志:=1表示接下来将会执行thumb指令, 否则则是标准的arm7指令<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;d6:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;FIQ抑制标志, :=1 抑制FIQ中断<br />
&nbsp; &nbsp;&nbsp; &nbsp;d7:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;IRQ抑制标志, :=1 抑制IRQ中断<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;剩下的则是<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;d31:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Z标志 结果为零 := 1, 否则为0<br />
&nbsp; &nbsp;&nbsp; &nbsp;d30:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;N标志 结果负数 := 1, 否则为0<br />
&nbsp; &nbsp;&nbsp; &nbsp;d29:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;C标志 结果进位 := 1, 否则为0<br />
&nbsp; &nbsp;&nbsp; &nbsp;d28:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;V标志 结果溢出 := 1, 否则为0<br />
&nbsp; &nbsp;&nbsp; &nbsp;这些标志是用来判断指令执行的结果的, 等同与X86的PSW<br />
&nbsp; &nbsp;&nbsp; &nbsp;需要注意的是, 当类 减法指令执行时, 如果产生进位则C为0, 否则C为1&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;好了, ARM7中, CPSR就这么多东西, ,如下 --<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;d31 - d28&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; d7&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; d6&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;d5&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;d4 d3 d2 d1 d0 <br />
&nbsp; &nbsp;&nbsp; &nbsp;N Z C V&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; IRQ抑制标识&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;FIQ抑制标识&nbsp; &nbsp; thumb标识&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;模式5位<br />
<br />
&nbsp; &nbsp; (*&nbsp;&nbsp;中断- <br />
&nbsp; &nbsp; (*----------*_*)<br />
&nbsp; &nbsp;&nbsp; &nbsp;ARM7有如下几种中断<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;Reset ;; 设备复位<br />
&nbsp; &nbsp;&nbsp; &nbsp;Data Abort ;;数据访问异常<br />
&nbsp; &nbsp;&nbsp; &nbsp;FIQ ;; 快速中断<br />
&nbsp; &nbsp;&nbsp; &nbsp;IRQ ;; 通用中断<br />
&nbsp; &nbsp;&nbsp; &nbsp;Prefetch Opcode ;; 指令预取异常<br />
&nbsp; &nbsp;&nbsp; &nbsp;Undef /SWI ;; 未定义指令, 软件中断<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;优先级从高到低<br />
&nbsp; &nbsp;&nbsp; &nbsp;这些中断大同小异, 有着大致相同的执行套路, 各自可能又有微小的差别<br />
&nbsp; &nbsp;&nbsp; &nbsp;在GBA内部的BIOS中, 如果设备启用的了Debug功能, 不被处理的异常可能会由BIOS转交给卡带<br />
&nbsp; &nbsp;&nbsp; &nbsp;内部地址的 9FE2000h/9FFC000h处理<br />
&nbsp; &nbsp;&nbsp; &nbsp;否则, BIOS会直接返回<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;大致套路:中断发生时, 把当前CPSR扔进目标模式的SPSR里,<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;然后禁止中断,<br />
&nbsp; &nbsp;&nbsp; &nbsp;把下一条指令,(有的要加上一个微小的偏移)得地址<br />
&nbsp; &nbsp;&nbsp; &nbsp;扔进目标模式r14中<br />
&nbsp; &nbsp;&nbsp; &nbsp;设置CPSR的模式位域, 清除T标志使以后执行的指令总是ARM7指令<br />
&nbsp; &nbsp;&nbsp; &nbsp;设置PC为具体中断的中断地址, 中断调用完成, 中断最小延迟为5个时钟周期, 最大为29个时钟周期<br />
<br />
<br />
&nbsp; &nbsp; (*&nbsp;&nbsp;具体中断的具体措施 (伪代码摘自ARM芯片手册卷 arm_arm.pdf::A2.6 Exceptions)- <br />
&nbsp; &nbsp; (*----------*_*)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&lt; Reset&gt; ;; 设备复位<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[4:0] = 0b10011<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[5] = 0<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[6] = 1<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[7] = 1<br />
&nbsp; &nbsp;&nbsp; &nbsp;PC = 0x00000000<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&lt; Undef&gt; ;; 未定义指令异常<br />
&nbsp; &nbsp;&nbsp; &nbsp;R14_und = 下一条即将执行的指令地址<br />
&nbsp; &nbsp;&nbsp; &nbsp;SPSR_und = CPSR<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[4:0] = 0b11011<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[5] = 0<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[7] = 1<br />
&nbsp; &nbsp;&nbsp; &nbsp;PC = 0x00000004<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&lt;SWI&gt; ;; 软件中断<br />
&nbsp; &nbsp;&nbsp; &nbsp;R14_svc = SWI指令的下一条指令地址<br />
&nbsp; &nbsp;&nbsp; &nbsp;SPSR_svc = CPSR<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[4:0] = 0b10011<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[5] = 0<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[7] = 1<br />
&nbsp; &nbsp;&nbsp; &nbsp;PC = 0x00000008<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&lt;IRQ&gt; ;; 通用中断<br />
&nbsp; &nbsp;&nbsp; &nbsp;R14_irq = 下一条即将执行的指令地址+4<br />
&nbsp; &nbsp;&nbsp; &nbsp;SPSR_irq = CPSR<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[4:0] = 0b10010<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[5] = 0<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[7] = 1<br />
&nbsp; &nbsp;&nbsp; &nbsp;PC = 0x00000018<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&lt; FIQ&gt; ;; 快速中断<br />
&nbsp; &nbsp;&nbsp; &nbsp;R14_fiq = 下一条即将执行的指令地址+4<br />
&nbsp; &nbsp;&nbsp; &nbsp;SPSR_fiq = CPSR<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[4:0] = 0b10001<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[5] = 0<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[6] = 1<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[7] = 1<br />
&nbsp; &nbsp;&nbsp; &nbsp;PC = 0x0000001C<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&lt;ABORT1&gt;指令访问异常<br />
&nbsp; &nbsp;&nbsp; &nbsp;R14_abt = 下一条即将执行的指令地址 + 4<br />
&nbsp; &nbsp;&nbsp; &nbsp;SPSR_abt = CPSR<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[4:0] = 0b10111<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[5] = 0<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[7] = 1<br />
&nbsp; &nbsp;&nbsp; &nbsp;PC = 0x0000000C<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&lt;ABORT2&gt;内存访问异常<br />
&nbsp; &nbsp;&nbsp; &nbsp;R14_abt = 下一条即将执行的指令地址 + 8<br />
&nbsp; &nbsp;&nbsp; &nbsp;SPSR_abt = CPSR<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[4:0] = 0b10111<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[5] = 0<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR[7] = 1<br />
&nbsp; &nbsp;&nbsp; &nbsp;PC = 0x00000010<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;下一条即将执行的指令地址基于当前指令执行完成, 下一条指令执行之前的时间点,<br />
&nbsp; &nbsp;&nbsp; &nbsp;中断如何返回请参阅后面章节<br />
</td></tr></table>


</div>
<div id="comment_17677" class="cm">
</div>

<div id="post_rate_div_17677"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17677"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17677&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17677&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17677').innerHTML ? $('review_support_17677').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17677"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17677&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17677').innerHTML ? $('review_against_17677').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17677"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17677" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17677', 'misc.php?mod=report&rtype=post&rid=17677&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17677_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17677')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17678" ><table id="pid17678" class="plhin" summary="pid17678" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17678" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17678" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17678_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17678')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17678" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17678_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17678" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17678_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17678_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17678&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17678"   id="postnum17678" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>5</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17678" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17678">发表于 2019-6-27 11:14:22</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17678">
&nbsp; &nbsp; (*&nbsp;&nbsp;Thumb, ARM7指令<br />
&nbsp; &nbsp; (*----------*_*)<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPSR的T标志指示即将执行ARM7 /Thum指令集<br />
&nbsp; &nbsp;&nbsp; &nbsp;ARM7增加了许多通用寄存器, 除了读写和少部分指令可以访问内存,<br />
&nbsp; &nbsp;&nbsp; &nbsp;其余主要ALU计算指令的 目标和源操作数只能为 寄存器,<br />
&nbsp; &nbsp;&nbsp; &nbsp;减少了指令编码压力, 改善指令的并发性,<br />
&nbsp; &nbsp;&nbsp; &nbsp;ARM7 / Thumb指令各有特点.<br />
&nbsp; &nbsp;&nbsp; &nbsp;ARM7和Thumb指令都是定长编码, ARM是四个字节, Thumb是两个字节<br />
&nbsp; &nbsp;&nbsp; &nbsp;其中, ARM7所有指令都可以条件执行, 可使用所有的寄存器.<br />
&nbsp; &nbsp;&nbsp; &nbsp;Thumb模式只能使用r0-r7 SP, CPSR, SPSR PC, 和LR寄存器, 部分指令可以控制其他高位寄存器<br />
&nbsp; &nbsp;&nbsp; &nbsp;两者指令集也有区别, 后面将会详细讲解.<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; (*&nbsp;&nbsp;三级流水线/时钟周期类型<br />
&nbsp; &nbsp; (*----------*_*)<br />
&nbsp; &nbsp;&nbsp; &nbsp;ARM具有三级指令流水线,<br />
&nbsp; &nbsp;&nbsp; &nbsp;在讲流水线之前, 先了解一下CPU的执行流程.<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPU会在当前PC指针处获取一个操作码(Opcode)<br />
&nbsp; &nbsp;&nbsp; &nbsp;然后对该操作码的各个位域进行识别, 从而知道这是哪一条指令<br />
&nbsp; &nbsp;&nbsp; &nbsp;知道哪条指令了, 就进行执行操作<br />
&nbsp; &nbsp;&nbsp; &nbsp;从内存中取操作码叫取指 (fetch)<br />
&nbsp; &nbsp;&nbsp; &nbsp;对该操作码的各个位域进行识别叫译码 (decode)<br />
&nbsp; &nbsp;&nbsp; &nbsp;就进行执行操作叫执行 (exec)<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;理想情况下, 每个步骤一个时钟周期.老的CPU就是单流水线, 操作全部串行.<br />
&nbsp; &nbsp;&nbsp; &nbsp;后来人们变聪明了, 发现这些部件在某段执行区间内可以并发执行而不会破坏程序逻辑<br />
&nbsp; &nbsp;&nbsp; &nbsp;取指的时候可以同时执行和译码, 这下nb了, 许多指令都变成单指令周期,<br />
&nbsp; &nbsp;&nbsp; &nbsp;理想情况可以提升三倍效率, 然而许多情况效率完全无法最大化, 多多少少会有效率损失<br />
&nbsp; &nbsp;&nbsp; &nbsp;比如在无cache或者cache miss的情况下, 访存可能有额外的waitState<br />
&nbsp; &nbsp;&nbsp; &nbsp;很多时候清洗流水线可能还会导致拖慢程序流程, 非单周期指令的总线周期冲突等等...<br />
&nbsp; &nbsp;&nbsp; &nbsp;但是总的来说速度应该是稳中有升的<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;流水线执行流程<br />
&nbsp; &nbsp;&nbsp; &nbsp;当流水线第一个时钟周期, 只有取指(因为此时没有可用的操作码可供解码, 更谈不上执行了).<br />
&nbsp; &nbsp;&nbsp; &nbsp;当流水线第二个时钟周期, 只有取指, 解码 (此时第一个时钟周期获得的操作码被解码).<br />
&nbsp; &nbsp;&nbsp; &nbsp;当流水线第三个时钟周期, 取指, 解码, 执行操作一气呵成, 以后每个周期都是 取指, 解码, 执行并发执行<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;我们来模拟一下流水线的执行流程(ARM7状态下, 非thumb, 单周期指令).<br />
&nbsp; &nbsp;&nbsp; &nbsp;初始状态 流水线基址 PC:= 0x1000<br />
&nbsp; &nbsp;&nbsp; &nbsp;Clks1前: PC:= 0x1000<br />
&nbsp; &nbsp;&nbsp; &nbsp;Clks1执行: 取指0x1000, PC增加<br />
&nbsp; &nbsp;&nbsp; &nbsp;Clks1后: RawOp1000, PC:= 0x1004<br />
&nbsp; &nbsp;&nbsp; &nbsp;Clks2前: RawOp1000, PC:= 0x1004<br />
&nbsp; &nbsp;&nbsp; &nbsp;Clks2执行: 解码RawOp1000, 取指0x1004, , PC增加<br />
&nbsp; &nbsp;&nbsp; &nbsp;Clks2后: RawOp1004, RipeOp1000, PC:= 0x1008<br />
&nbsp; &nbsp;&nbsp; &nbsp;Clks3前: RawOp1004, RipeOp1000, PC:= 0x1008<br />
&nbsp; &nbsp;&nbsp; &nbsp;Clks3执行: 执行RipeOp1000, 解码RawOp1004, 取指0x1008, PC增加<br />
&nbsp; &nbsp;&nbsp; &nbsp;Clks3后: RawOp1008, RipeOp1004, PC:= 0x100C<br />
&nbsp; &nbsp;&nbsp; &nbsp;ClksN前: RawOp[BASE_PC+(N-2)*4] , RipeOp[BASE_PC+(N-3)*4], PC:= BASE_PC+(N-1)*4<br />
&nbsp; &nbsp;&nbsp; &nbsp;ClksN执行: 执行RipeOp[BASE_PC+(N-3)*4], 解码RawOp[BASE_PC+(N-2)*4], 取BASE_PC+(N-1)*4, PC增加<br />
&nbsp; &nbsp;&nbsp; &nbsp;ClksN后: RawOp[BASE_PC+(N-1)*4], RipeOp[BASE_PC+(N-2)*4], PC:= BASE_PC+N*4<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;可以观察到, Clks3开始指令流就可以并发了<br />
&nbsp; &nbsp;&nbsp; &nbsp;即使不是单指令周期,<br />
&nbsp; &nbsp;&nbsp; &nbsp;ARM7内部指令流序列也会保证, 在每条指令执行前, PC到了PC+8/+4的地方<br />
&nbsp; &nbsp;&nbsp; &nbsp;这其实也暗示了, 管道里至少有一条指向当前执行下一条指令的等待被译码的RawOp<br />
&nbsp; &nbsp;&nbsp; &nbsp;执行后, RawOp变RipeOp, 新的RawOp被取指, 如此循环...<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;你可以看到, CLks3开始指令的执行才变得有规律起来<br />
&nbsp; &nbsp;&nbsp; &nbsp;当流水线被清洗, 流水线时钟会重新开始计时直到第三个时钟周期, 又可以并发执行.<br />
&nbsp; &nbsp;&nbsp; &nbsp;当那些会改变PC的指令被执行时, 流水线会被清洗, 中断执行也会清洗流水线<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp; (* 时钟周期类型<br />
&nbsp; &nbsp; (*----------*_*)<br />
&nbsp; &nbsp;&nbsp; &nbsp;ARM7内部有四个周期类型,<br />
&nbsp; &nbsp;&nbsp; &nbsp;根据各个信号电平不同可以划分为以下4个<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;为了简单, 给出总线信号的两个关联信号类型<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;SEQ信号:序列化信号 电平高有效, 指示接下来的访问为连续线性内存访问<br />
&nbsp; &nbsp;&nbsp; &nbsp;nMREQ: 内存需求信号, 电平低有效, 指示接下来发生内存访问<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;非连续周期(N) nMREQ:0, SEQ:0 :<br />
&nbsp; &nbsp;&nbsp; &nbsp;连续周期(S) nMREQ:0, SEQ:1 :<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;非线性顺序访问内存导致的周期叫非连续周期<br />
&nbsp; &nbsp;&nbsp; &nbsp;线性顺序访问内存导致的周期叫连续周期<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;举个例子:当前PC:=1000,<br />
&nbsp; &nbsp;&nbsp; &nbsp;下一条指令发生为无条件跳转到2000<br />
&nbsp; &nbsp;&nbsp; &nbsp;这时候PC不是本身的1000, 也不是接下来的1000后的线性地址1004开始的一个byte/halfword/word,<br />
&nbsp; &nbsp;&nbsp; &nbsp;内存访问的连续性发生了突变, 则是N周期<br />
&nbsp; &nbsp;&nbsp; &nbsp;N-S周期除了反映访问内存的情况外, 还会影响GBA卡带的WaitState状态,<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;在非连续周期ARM会延长更多的MCLK时钟周期访问卡带, 浪费更多的时间取数据/指令.<br />
&nbsp; &nbsp;&nbsp; &nbsp;内部周期(I) nMREQ:1, SEQ:1 :<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPU在执行内部操作, 这个时候不会发生内存访问, 卡带会预取缓存<br />
&nbsp; &nbsp;&nbsp; &nbsp;协处理器周期(C) nMREQ:1, SEQ:1 ::<br />
&nbsp; &nbsp;&nbsp; &nbsp;不管, GBA不处理协处理器<br />
&nbsp; &nbsp;&nbsp; &nbsp;每个周期类型占用一个时钟周期<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;更多关于ARM7TDMI总线的资料, 请参阅CPU手册, 或者上海交大PPT文档的ARM7TDMI总线接口</td></tr></table>


</div>
<div id="comment_17678" class="cm">
</div>

<div id="post_rate_div_17678"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17678"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17678&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17678&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17678').innerHTML ? $('review_support_17678').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17678"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17678&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17678').innerHTML ? $('review_against_17678').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17678"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17678" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17678', 'misc.php?mod=report&rtype=post&rid=17678&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17678_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17678')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17679" ><table id="pid17679" class="plhin" summary="pid17679" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17679" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17679" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17679_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17679')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17679" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17679_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17679" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17679_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17679_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17679&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17679"   id="postnum17679" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>6</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17679" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17679">发表于 2019-6-27 11:18:33</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17679">
<font color="Red">---------------------------------------------------------CPU-ARM7指令---------------------------------------------------------------------</font></td></tr></table>


</div>
<div id="comment_17679" class="cm">
</div>

<div id="post_rate_div_17679"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17679"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17679&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17679&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17679').innerHTML ? $('review_support_17679').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17679"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17679&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17679').innerHTML ? $('review_against_17679').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17679"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17679" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17679', 'misc.php?mod=report&rtype=post&rid=17679&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17679_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17679')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17680" ><table id="pid17680" class="plhin" summary="pid17680" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17680" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17680" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17680_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17680')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17680" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17680_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17680" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17680_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17680_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17680&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17680"   id="postnum17680" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>7</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17680" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17680">发表于 2019-6-27 11:23:21</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17680">
<i class="pstatus"> 本帖最后由 moecmks 于 2019-6-27 11:29 编辑 </i><br />
<br />
(* <font color="#ff0000">访存指令</font> LDR/STR/LDM/STM/SWP<br />
(*----------*_*)<br />
&nbsp;&nbsp;LDR:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;从内存中读word或者 halfword,byte,无符号/符号扩展成word<br />
&nbsp;&nbsp;LDM:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;指定地址多次连续读取进指定寄存器集, 寄存器入栈<br />
&nbsp;&nbsp;STM:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;指定寄存器集连续写进内存, 寄存器出栈<br />
&nbsp;&nbsp;SWP:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;寄存器值和指定内存地址的值交换<br />
<br />
&nbsp;&nbsp;LDR/STR就不用多说了, 读写内存是最基本的内存访问手段<br />
<br />
&nbsp;&nbsp;LDM/STM有两个用处,&nbsp;&nbsp;1是保持指定的上下文寄存器,<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;2是单指令拷存(memcpy)减少代码尺寸.<br />
<br />
&nbsp;&nbsp;SWP, 类似与XCHG, 相似的是, 这条指令也是一条原子指令,<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;提供对高级同步原语的底层支持 <br />
<br />
&nbsp; &nbsp; (* 标准访存指令 LDR/STR/LDRB/STRB<br />
&nbsp; &nbsp; (*++++++++++*_*)&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;LDR,&nbsp; &nbsp;&nbsp; &nbsp;读内存, 读得时候有五种类型 Word, 无符号 Halfword/byte, 后者会无符号扩展为Word放入Rd寄存器<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;有符号 Halfword/byte, 会符号扩展为Word放入Rd寄存器<br />
&nbsp; &nbsp;&nbsp; &nbsp;STR,&nbsp; &nbsp;&nbsp; &nbsp;写内存, 这就简单多了, Word/HalfWord/Byte 三种写入形式<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 机器码编码把LDR Word/Byte STR Word/Byte编码成一类, 其余的另外自成一码.寻址方式也是有部分不同.<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;STR/LDR唯一区别是 Rd, LDR计算好地址把数据读到Rd, STR则是把Rd的数据写进内存&nbsp; &nbsp;&nbsp; &nbsp; <br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;寻址计算有两种方式:<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&lt;立即数寻址&gt;&nbsp; &nbsp;三个操作数 Rd, Rn, -/+Imm12<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Rn+正负12位立即数地址范围 例子 LDRB Rd, [Rn, #960], 取Rn+960的一个字节<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;例子 LDREQ Rd, [Rn, #4],l 上次执行结果测试是否相等, 相等取Rn+4的一个Word<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&lt;寄存器移位&gt;&nbsp; &nbsp;五个操作数 Rd/Rn/Rm/ShiftImm5/Shift 移位类型<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 对于寄存器移位 有如下公式 <br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 地址:= Rn+Index<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Index:= -/+ Rm 移位类型 5位移位立即数<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 移位类型有五种<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; LSL&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;逻辑左移<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; LSR&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;逻辑右移<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; ASR&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;算术右移<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; ROR&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;循环右移<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; RRX&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;逻辑右移1位, C位进入 MSB(第31位), 此时没有立即数操作数, 实际机器码编码中<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;RRX是 ROR Imm5等于0的情况下发生的特殊指令<br />
&nbsp; &nbsp;&nbsp; &nbsp;关于移位类型和Imm5移位操作数<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;当Imm5等于0的时候, 会发生很多诡异的移位行为<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;想想也情有可原, Imm5是固定编码, 即-程序员是知道自己写了Imm5移位量的这个滑稽的无意义操作的.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;但是谁没事写移位量为0的移位给自己添堵呢?有啥用呢, 所以ARM就充分利用了这部分编码<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;对于 LSL Rm还是Rm, 形如 Op Rd, Rn, Rm这样指令是没有额外的编码空间的, 所以把它编码成 Op Rd, Rn, Rm, LSL #0的形式<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;对于 LSR Rm此时为0<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;对于 ASR 测试Rm的第31位, 如果为1那么Rm:= 0xFFFFFFFF否则为0<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;对于 ROR 此时执行RRX指令<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;寻址方式 &lt;后索引 | 前索引&gt;<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;后索引寻址: 直接用Rn作为访问地址, 访存完成后照寻址计算规则执行指令操作, 把计算的得到地址写回Rn<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;前索引寻址: 照寻址计算规则执行指令操作获得地址, 访存完成后可决定地址是否写回Rn<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;前索引和后索引类似于+i和i+的区别<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;前索引寻址表示形式就是通常写法, 后面加个感叹号表示写回基地址Rn<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;后索引寻址表示形式 LDR Rd, [Rn], #<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;前索引寻址表示形式 LDR Rd, [Rn, #]<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;前索引的几个例子:<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;LDRNEB R1, [R0, #2]!<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;LDR R8, [R0, R2,LSL #2]!<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;STREQB R3, [R0]!<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;后索引的几个例子:<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;LDRB R3, [R0]<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;STRHSB R3, [R0], #-0x17<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;LDREQB R3, [R0], R2,RRX&nbsp; &nbsp;&nbsp; &nbsp;<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;T后缀声言:&nbsp; &nbsp; 指示访存是在用户模式下,即使是特权模式<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;注意, 不能和前索引配合使用<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;这个后缀主要用来验权, 通常是不使用的<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;比如你在用户模式触发了非法访存(可能是内存页保护),<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;当你在异常处修复了这个错误<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;LDRT用于模拟在用户模式下验证访存是否正常<br />
<br />
&nbsp; &nbsp; (* LDR/STR/LDRB/STRB 机器码<br />
&nbsp; &nbsp; (***********_*)&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;27 26 25 24 23 22 21 20&nbsp; &nbsp; 19 - 16&nbsp; &nbsp;&nbsp;&nbsp;15 - 12&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;11 10 9 8 7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;1&nbsp;&nbsp;I&nbsp;&nbsp;P&nbsp;&nbsp;U&nbsp;&nbsp;B&nbsp;&nbsp;W&nbsp;&nbsp;L&nbsp; &nbsp;&nbsp; &nbsp; Rn&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Rd&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Offset (d11-d0)<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;Rd: LDR读取加载到Rd, STR从Rd写入<br />
&nbsp; &nbsp;&nbsp; &nbsp;Rn:索引地址<br />
&nbsp; &nbsp;&nbsp; &nbsp;I ? 寄存器移位: 12位立即数<br />
&nbsp; &nbsp;&nbsp; &nbsp;U ? 正偏移 :负偏移<br />
&nbsp; &nbsp;&nbsp; &nbsp;B ? byte : word<br />
&nbsp; &nbsp;&nbsp; &nbsp;L ? 读LDR :写STR<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;W和P联合指示<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;W:0 P:0 后索引寻址写回<br />
&nbsp; &nbsp;&nbsp; &nbsp;W:0 P:1 前索引寻址不写回<br />
&nbsp; &nbsp;&nbsp; &nbsp;W:1 P:0 后索引寻址写回+T后缀声言<br />
&nbsp; &nbsp;&nbsp; &nbsp;W:1 P:1 前索引寻址写回&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&lt;寄存器移位&gt;<br />
&nbsp; &nbsp;&nbsp; &nbsp;d11-d7: 移位立即数 (5bit 0-31)<br />
&nbsp; &nbsp;&nbsp; &nbsp;d6-d5:移位类型 0: LSL 1: LSR 2:ASR 3:ROR RRX:ROR移位量为0<br />
&nbsp; &nbsp;&nbsp; &nbsp;d4:0<br />
&nbsp; &nbsp;&nbsp; &nbsp;d3-d0:Rm<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;立即数寻址都是常规套路, 不写了.<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;LSL-&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 常规操作<br />
&nbsp; &nbsp;&nbsp; &nbsp;LSR-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;#Imm5bit = 0 索引为0<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;#Imm5bit!= 0 常规操作<br />
&nbsp; &nbsp;&nbsp; &nbsp;ASR-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;#Imm5bit = 0 &amp;&amp; Rm[31] = 1, 索引为0xFFFFFFFF<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;#Imm5bit = 0 &amp;&amp; Rm[31]!= 1, 索引为0<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;#Imm5bit!= 0 常规操作<br />
&nbsp; &nbsp;&nbsp; &nbsp;ROR-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;#Imm5bit = 0 RRX<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;#Imm5bit!= 0 常规操作&nbsp; &nbsp; <br />
<br />
&nbsp; &nbsp; (* 标准访存指令 LDRH/STRH/LDRSB/LDRSH<br />
&nbsp; &nbsp; (*++++++++++*_*)&nbsp; &nbsp; <br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;跟上面差不多, 12位立即数变成8位<br />
&nbsp; &nbsp;&nbsp; &nbsp;没有寄存器移位, 只有简单的Rn+/-Rm<br />
&nbsp; &nbsp;&nbsp; &nbsp;其余的都是一样的. 哦,还一点不一样,不能用T声言后缀&nbsp; &nbsp;&nbsp;&nbsp;<br />
<br />
&nbsp; &nbsp; (* LDRH/STRH/LDRSB/LDRSH 机器码 1,用于寻址立即数.<br />
&nbsp; &nbsp; (***********_*)&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp;&nbsp;27 26 25 24 23 22 21 20&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;19 - 16&nbsp; &nbsp;&nbsp; &nbsp;15 - 12&nbsp; &nbsp; 11 10 9 8&nbsp; &nbsp;7 6 5 4&nbsp; &nbsp;3 2 1 0<br />
&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;P&nbsp;&nbsp;U&nbsp;&nbsp;1&nbsp;&nbsp;W&nbsp;&nbsp;L&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Rn&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Rd&nbsp; &nbsp;&nbsp; &nbsp; Offset1&nbsp; &nbsp; 1 S H 1&nbsp; &nbsp;Offset2 (d22位那是数字1不是字母I)<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;L:读写控制位?LDR:STR<br />
&nbsp; &nbsp;&nbsp; &nbsp;S:符号控制位?有符号:无符号<br />
&nbsp; &nbsp;&nbsp; &nbsp;H:half控制位?half:byte<br />
&nbsp; &nbsp;&nbsp; &nbsp;这几个标志位组合很混乱,在ARM7TDMI中只有如下几种情况<br />
&nbsp; &nbsp;&nbsp; &nbsp;(注意!!! S|H绝对不会为0,这也是这条指令可以被无二义识别的关键因素)<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;L = 0, S = 0, H = 1 STRH halfword<br />
&nbsp; &nbsp;&nbsp; &nbsp;L = 1, S = 0, H = 1 LDRH<br />
&nbsp; &nbsp;&nbsp; &nbsp;L = 1, S = 1, H = 0 LDRSB<br />
&nbsp; &nbsp;&nbsp; &nbsp;L = 1, S = 1, H = 1 LDRSH<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;halfword/byte会根据有无符号按movzx/movsx方式扩展成32位<br />
&nbsp; &nbsp;&nbsp; &nbsp;其余的ldr也是一样<br />
&nbsp; &nbsp;&nbsp; &nbsp;P 同上<br />
&nbsp; &nbsp;&nbsp; &nbsp;U 同上<br />
&nbsp; &nbsp;&nbsp; &nbsp;W: 当P= 0, 必须为0, 因为此模式无T后缀声言<br />
&nbsp; &nbsp;&nbsp; &nbsp;当P= 1, 同上<br />
&nbsp; &nbsp;&nbsp; &nbsp;Offset1, Offset2组成一个八位的偏移, 配合U位, 可寻址+/-256范围内的数据<br />
&nbsp; &nbsp;&nbsp; &nbsp;Offset1 &lt;- HI<br />
&nbsp; &nbsp;&nbsp; &nbsp;Offset2 &lt;- LO<br />
</td></tr></table>


</div>
<div id="comment_17680" class="cm">
</div>

<div id="post_rate_div_17680"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17680"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17680&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17680&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17680').innerHTML ? $('review_support_17680').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17680"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17680&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17680').innerHTML ? $('review_against_17680').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17680"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17680" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17680', 'misc.php?mod=report&rtype=post&rid=17680&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17680_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17680')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17681" ><table id="pid17681" class="plhin" summary="pid17681" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17681" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17681" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17681_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17681')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17681" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17681_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17681" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17681_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17681_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17681&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17681"   id="postnum17681" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>8</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17681" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17681">发表于 2019-6-27 11:29:21</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17681">
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(* LDRH/STRH/LDRSB/LDRSH 机器码 2,用于寻址寄存器<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(***********_*)&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 27 26 25 24 23 22 21 20&nbsp; &nbsp; 19 - 16&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;15 - 12&nbsp; &nbsp;11 10 9 8 7 6 5 4&nbsp; &nbsp; 3 2 1 0<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;P&nbsp;&nbsp;U&nbsp;&nbsp;0&nbsp;&nbsp;W&nbsp;&nbsp;L&nbsp; &nbsp;&nbsp; &nbsp; Rn&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rd&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp;&nbsp;0 0 0 1 S H 1&nbsp; &nbsp;&nbsp; &nbsp; Rm <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 标志位同上, Rm是32位 全偏移<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(* 栈操作访存指令 LDM/STM<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(*++++++++++*_*)&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; LDM LDR Multi 的缩写, STM同理<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 一个寄存器集出栈, 一个入栈<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 不像X86的PUSH/ POP ..<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; LDM/STM有着更加丰富的栈操作玩法<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 栈增长方式可以往下, 也就是进栈一个寄存器, 地址-4(一个寄存器四个字节(Word))<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 也可以往上, 也就是进栈一个寄存器, 地址+4(一个寄存器四个字节(Word))<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 对于提交的基地址Rn,<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; LDM/STM操作的时候也可以选择包括这一个地址或者在这个地址+/-4的位置开始栈操作<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 基地址偏移选择和栈增长方式都有各种两种操作, 组合起来就能有四种操作方式<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1. 栈方向往下- 基址包括 DA ED (指令声言)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2. 栈方向往下- 基址排除 DB FD (指令声言)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 3. 栈方向往上- 基址包括 IA EA (指令声言)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 4. 栈方向往上- 基址排除 IB FA (指令声言)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 这四种方式STM/ LDM都能用, 不怕没有你想用的.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 栈方向排斥的一对, 和基址排斥的一对可以组成一对 PUSH/ POP来保持上下文<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 栈方向和基址相同的, 可以组成拷存例程减少代码尺寸, 十分灵活.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 有人可能会问了? 栈操作方向相反, 为啥基址也要排斥呢?<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 举个基地址操作相同的例子 LDM使用类型1, STM使用类型3, 栈方向相反, 皆为基址包括<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; SP:=1000 STM你推一个寄存器进去 基址包括, 写进1000, SP+=4<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; SP:=1004<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 你要拿出来, 你用类型3,LDM去取, 基址包括, 取1004, SP-=4<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; SP:=1000, 很明显取错地方了, 用基址排除, 先减-4, 1000,取1000这次终于正常啦<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 基地址操作相同, 取/写总会有一个单元的偏移, 所以要基址排斥<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 四种类型有着更利于人理解的名字<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; STMIB 地址先增而后完成操作 STMFA 满递增堆栈<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; STMIA 完成操作而后地址递增 STMEA 空递增堆栈<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; STMDB 地址先减而后完成操作 STMFD 满递减堆栈<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; STMDA 完成操作而后地址递减 STMED 空递减堆栈<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 同行的表示同一种操作方式, 名字不同而已<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; LDM/STM 语法<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; ACCESS:= LDM | STM<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; ADDRM:= DA|DB|IA|IB|ED|FD|EA|FA<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; WB:= !(WriteBack Rn) | null<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; AC:= ^(Same as User Mode)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; #:=Literal link<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; ACCESS#Cond#ADDRM Rn WB, {寄存器集合表达式} AC<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rn提供基地址<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; ^表示操作的寄存器集都是用的用户模式下的寄存器集合<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; !感叹号表示用于栈计算的地址最后会被写回Rn<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 寄存器集合表达式怎么写呢?<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 简单地一个可以直接这么写 {R3}, 例子 LDMEQIA R0, {R3}<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 多个可以这么写Rstart-Rend, 多个非连续段寄存器用,链接起来<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 例子, LDMEQIA R0, {R3-R15}<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; STMEQED R0!, {R0, R2-R3, R4-R10, R12, R13, R14-R15}^<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(* LDM/STM 机器码<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(***********_*) <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 27 26 25 24 23 22 21 20&nbsp; &nbsp; 19 - 16&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;15 - 12 11 10 9 8 7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;P&nbsp;&nbsp;U&nbsp;&nbsp;S&nbsp;&nbsp;W&nbsp;&nbsp;L&nbsp; &nbsp;&nbsp; &nbsp; Rn&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Register List (d15-d0) 寄存器栈操作<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; L?LDM(POP):STM(PUSH)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rn:出栈/入栈用的基址, 不一定要是r13 (sp).<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; U?升栈:降栈PUSH/POP 升PUSH/POP由低变高, 降PUSH/POP地址由高变低<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Register List:寄存器列表, 按d15指示r15-&gt; d0指示r0的序列排列, 1指示当前位置的寄存器被PUSH/POP<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; W?更新基址Rn:不更新<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; P?不包括当前地址, 会按照当前栈方向先上升一个单元:包括<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; S?对于LDM&amp;&amp;当前Register List包含r15, SPSR拷贝进CPSR<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; S?对于STM || (LDM&amp;&amp;当前Register List不包含r15), 拷贝进用户模式下的通用寄存器<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 无论何种方式,<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 寄存器集在内存低到高总是按照R0-R15增长方向排列的 (此测试基于CodeWarrior for ARM Developer Suite IDE)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 读取PC会对齐一个Word地址 (&amp;-4)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 当Rn不对齐时, 也会强制对齐一个Word,<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 如果此时再次写回Rn, 这个写回的地址却不会是对齐的 (此测试基于CodeWarrior for ARM Developer Suite IDE)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Reglist 与写回Base 寄存器Rn 冲突时的UB行为<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 对于LDM 写回不发生, 此测试基于 CodeWarrior IDE<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 对于STM, 如果是最低有效位, 则写入Rn的原始值, 否则会写回计算完成的Rn地址, 此测试基于 CodeWarrior IDE<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &lt;STM &amp;&amp; R15&gt;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 当STM中写入R15-PC时, 会轧入R15+12(这个R15是当前这条指令的地址)的值,<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 此测试基于CodeWarrior 4.25, STR也是如此<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 基于 Keil MDK-Lite 4.70.0 会轧入0<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(* 原子交换 SWP.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(*++++++++++*_*)&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 语法:SWP[B] Cond Rd Rm [Rn]<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rn:地址<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rm:将要写进内存的值<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rd:读出的值写进Rd<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(* SWP 机器码<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(***********_*)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 27 26 25 24 23 22 21 20&nbsp; &nbsp;19 - 16&nbsp; &nbsp; 15 - 12&nbsp; &nbsp; 11 10 9 8 7 6 5 4&nbsp; &nbsp;3 2 1 0<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0 0&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;B&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;Rn&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Rd&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;0 0 0 1 0 0 1&nbsp; &nbsp;&nbsp;&nbsp;Rm 数据交换<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; B:1?交换8bit:交换32bit<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rd:内存区域加载到此寄存器<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rn:内存地址<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rm:写入内存的字节/32bit<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 对齐测试:对于读:=LDR, 对于写:=STR, 8位写入的时候只写入八位数据, 读取的时候会8bit零扩展为32位<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 上述所有访存指令都不影响标志位<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 访存指令在修改PC的时候会刷新当前CPU流水线, 至此, 标准ARM7的访存指令解释结束</td></tr></table>


</div>
<div id="comment_17681" class="cm">
</div>

<div id="post_rate_div_17681"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17681"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17681&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17681&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17681').innerHTML ? $('review_support_17681').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17681"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17681&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17681').innerHTML ? $('review_against_17681').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17681"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17681" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17681', 'misc.php?mod=report&rtype=post&rid=17681&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17681_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17681')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17682" ><table id="pid17682" class="plhin" summary="pid17682" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17682" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17682" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17682_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17682')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17682" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17682_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17682" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17682_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17682_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17682&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17682"   id="postnum17682" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>9</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17682" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17682">发表于 2019-6-27 11:30:59</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17682">
(* <font color="Red">标准ALU指令</font> ADD/SUB/ADC/SBC/RSB/RSC /CMP/CMN/TST/TEQ/MOV/MVN /BIC/AND/ORR/EOR<br />
(*----------*_*)<br />
&nbsp;&nbsp;ADD/SUB 正常加减 举个例子 ADD Rd, Rn, Rm (Rm+Rn放进Rd寄存器中)<br />
&nbsp;&nbsp;ADC/SBC 带进位加减 SBC是结果进位C清零<br />
&nbsp;&nbsp;RSB/RSC 反序减法(RSC带进位) RSB Rd, Rn, Rm (Rm-Rn放进Rd寄存器中)<br />
&nbsp;&nbsp;CMP/CMN 行为类似ADD/SUB, CMP对应ADD, CMN对应SUB.但是不保持结果, 用于测试执行结果<br />
&nbsp;&nbsp;AND 操作数相与<br />
&nbsp;&nbsp;ORR 操作数相或<br />
&nbsp;&nbsp;EOR 操作数异或<br />
&nbsp;&nbsp;TST 操作数相与不保持结果, 用于测试执行结果<br />
&nbsp;&nbsp;TEQ 操作数异或不保持结果, 用于测试执行结果<br />
&nbsp;&nbsp;BIC 操作数与第二个操作数取反相与<br />
&nbsp;&nbsp;MOV 寄存器之间互相拷贝<br />
&nbsp;&nbsp;MVN 寄存器取反拷贝<br />
&nbsp;&nbsp;除了CMP/CMN/TST/TEQ外都能设置是否影响标志位, 而这几个都会影响标志位, 无论是否设置.<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;这些ALU指令都有一个统称的Oprand2, 一共12位<br />
&nbsp;&nbsp;这个Oprand2根据不同需求会被分别解释成三种类型的寻址计算<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;1. 8位立即数+4位偶数移位数 扩展成32位立即数,&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;注意,这个移位是循环右移, 并且也可能因为设置影响C位 <br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;2. 5位移位立即数+移位类型+Rm,&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 这个跟上面LDR用的移位是一样的, 不同的是某些指令设置影响标志位时, <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;移位进位会进入C位 (Rs移位也如此)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;这个C位是否影响标志位取决于所执行的指令是否影响C位, <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;如果本身也影响将会忽略移位的C位进位<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;当然ALU指令没有设置影响标志也不会测试C位, Rs移位也是一样<br />
&nbsp;&nbsp;3. Rs移位寄存器+移位类型+Rm<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;差不多, 跟上面一样, 移位量取最低的一个字节, 多了对&gt;=32移位量的判断, <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;使用Rs移位会增加一个I周期<br />
&nbsp;&nbsp;具体情况如下, 只写特殊情况了, 常规操作不写了,大家应该都懂的:<br />
&nbsp;&nbsp;对于所有Rs移位 Rs:=0, 都是 Operand2 = Rm, C 不变<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;LSL-#Imm5bit<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;#Imm5bit = 0 Operand2 = Rm, 不影响C位<br />
&nbsp;&nbsp;LSL-Rs<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rs = 32 Operand2 = 0, C:= Rm bit0<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rs &gt; 32 Operand2 = 0, C := 0<br />
&nbsp;&nbsp;LSR-#Imm5bit<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;#Imm5bit = 0 Operand2 = 0, C:= Rm bit31<br />
&nbsp;&nbsp;LSR-Rs<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rs = 32 Operand2 = 0, C:= Rm bit31<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rs &gt; 32 Operand2 = 0, C := 0<br />
&nbsp;&nbsp;ASR-#Imm5bit<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;#Imm5bit = 0 Operand2 = (Rm bit31)? 0 :0xFFFFFFFF:, C:= Rm bit31<br />
&nbsp;&nbsp;ASR-Rs<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rs = 32 Operand2 = 0, C:= Rm bit31<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rs &gt; 32 Operand2 = (Rm bit31)? 0 :0xFFFFFFFF:, C:= Rm bit31<br />
&nbsp;&nbsp;ROR-#Imm5bit<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;#Imm5bit = 0 RRX<br />
&nbsp;&nbsp;ROR-Rs<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;if Rslo5bit = 0 Operand2 = Rm, C:= Rm bit31<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;else 基本操作, 此模式只使用低5位.<br />
<br />
&nbsp;&nbsp;Operand2 3种形式格式<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;1. 八位循环移位+ROR Operand2:= Imm32:= Imm8 &gt;&gt; (Shift*2)<br />
&nbsp;&nbsp;2. Shift+Imm5 Operand2:= Rm ShiftType ShiftImm5bit<br />
&nbsp;&nbsp;3. Shift+Rs Operand2:= Rm ShiftType Rs's Byte<br />
<br />
&nbsp;&nbsp;各种形式都举几个例子哈!, Oprand2具体形式位域编码见后面机器码表<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;1. 八位移位+ROR&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;MOV R1, #0x80000000<br />
&nbsp;&nbsp;2. Shift+Imm5&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;MOV R1, R0, LSL #2<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; SBC R1, R0, RRX<br />
&nbsp;&nbsp;2. Shift+Rs&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; MOV R1, R0, LSL R2<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;MOVS R1, R0, LSL R2 ;; MOVS, S表示同时设置标志位<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;``````````````` ADD/SUB/ADC/SBC/RSB/RSC/CMP/CMN<br />
&nbsp;&nbsp;这几个操作数都是相加,相减<br />
&nbsp;&nbsp;对于 保持结果到Rd的指令有 Rd, Rn, Operand2 形式的操作<br />
&nbsp;&nbsp;对于 比较不保持结果的指令 不使用Rd位域, 即使他是有位域编码存在, 只有 Rn, Operand2 形式的操作<br />
&nbsp;&nbsp;对于 比较不保持结果的指令设置S与否始终会设置标志位 .<br />
&nbsp;&nbsp;这些指令都会影响NZCV标志位 (如果设置了S标志位)<br />
&nbsp;&nbsp;对于带进位减法指令, 当C位为0, 会额外减去一个1, 跟带进位加法相反!, thumb指令的alu也是如此<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;``````````````` AND/ORR/EOR/TST/TEQ<br />
&nbsp;&nbsp;这几个操作数都是逻辑操作<br />
&nbsp;&nbsp;对于 保持结果到Rd的指令有 Rd, Rn, Operand2 形式的操作<br />
&nbsp;&nbsp;对于 比较不保持结果的指令 不使用Rd位域, 即使他是有位域编码存在, 只有 Rn, Operand2 形式的操作<br />
&nbsp;&nbsp;对于 比较不保持结果的指令设置S与否始终会设置标志位 .<br />
&nbsp;&nbsp;这些指令都会影响NZ标志位 (如果设置了S标志位, C位看移位类型了, 否则不影响)<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;``````````````` MOV/MVN/BIC<br />
&nbsp;&nbsp;这几个操作数都是寄存器之间传输操作<br />
&nbsp;&nbsp;都是 Rd, Rn, Operand2 形式的操作<br />
&nbsp;&nbsp;这些指令都会影响NZ标志位 (如果设置了S标志位, C位看移位类型了, 否则不影响)<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;(* 主ALU 机器码<br />
&nbsp;&nbsp;(***********_*)<br />
&nbsp; &nbsp;27 26 25&nbsp; &nbsp;24 23 22 21&nbsp; &nbsp;20&nbsp; &nbsp;&nbsp;&nbsp;19 - 16&nbsp; &nbsp;&nbsp;&nbsp;15 - 12&nbsp; &nbsp;&nbsp; &nbsp; 11 10 9 8 7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp; 0&nbsp;&nbsp;0&nbsp;&nbsp;I&nbsp; &nbsp;&nbsp; &nbsp;Opcode&nbsp; &nbsp;&nbsp; &nbsp;S&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Rn&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rd&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Operand2<br />
&nbsp; &nbsp; <br />
&nbsp;&nbsp;oprand2: 编码1 (I =1) : 4位移位+8位数据 d0-d7 8位立即数, d8-d11 4位偶数移位数<br />
&nbsp;&nbsp;编码2 (I =0 &amp;&amp; d4=0) : 寄存器移位 5位移位量(d11-d7)+2位移位类型(d6-d5)+4位寄存器索引(d3-d0)<br />
&nbsp;&nbsp;编码3 (I =0 &amp;&amp; d4=1 &amp;&amp; d7 = 0) :<br />
&nbsp;&nbsp;寄存器RS移位 RS寄存器索引(d11-d8)+2位移位类型(d6-d5)+4位寄存器索引(d3-d0)<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;Opcode指示具体的 ALU/逻辑处理指令 - 操作模式<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;0: AND Rd,Rn,Operand2<br />
&nbsp;&nbsp;1: EOR Rd,Rn,Operand2<br />
&nbsp;&nbsp;2: SUB Rd,Rn,Operand2<br />
&nbsp;&nbsp;3: RSB 反序 Sub Rd,Rn,Operand2<br />
&nbsp;&nbsp;4: ADD Rd,Rn,Operand2<br />
&nbsp;&nbsp;5: ADC Rd,Rn,Operand2<br />
&nbsp;&nbsp;6: SBC Rd,Rn,Operand2<br />
&nbsp;&nbsp;7: RSC 反序 Sbc Rd,Rn,Operand2<br />
&nbsp;&nbsp;8: TST Rn,Operand2 (S位域必为1, 同时如果是Rs/Imm5移位寻址会测试移位C来设置CPSR的进位状态位)<br />
&nbsp;&nbsp;9: TEQ XOR不保持结果 Rn,Operand&nbsp;&nbsp;(S位域必为1, 同时如果是Rs/Imm5移位寻址会测试移位C来设置CPSR的进位状态位)<br />
&nbsp;&nbsp;A: CMP Rn,Operand2 (S位域必为1)<br />
&nbsp;&nbsp;B: CMN A+B不保持结果 Rn,Operand2 (S位域必为1)<br />
&nbsp;&nbsp;C: ORR OR Rd,Rn,Operand2<br />
&nbsp;&nbsp;D: MOV Rd,Operand2<br />
&nbsp;&nbsp;E: BIC 位清理 Rd,Rn,Operand2, rd:= rd &amp; ~rn<br />
&nbsp;&nbsp;F: MVN 取反MOV Rd,Operand2 rd := ~rm <br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;SUB/ADD/ADC/SBC/CMP/CMN/RSB/RSC 设置NZCV<br />
&nbsp;&nbsp;EOR/ORR/AND/TST/TEQ/BIC/MVN/MOV 设置NZC-(C由移位Operand2获得)<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;S表示是否设置CPSR标志位, 1设置0不设置<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;对于ALU操作中具有Rd参数且设置S标志的指令且Rd=PC的情况下<br />
&nbsp;&nbsp;会把当前模式下的SPSR缓存PSR拷贝到CPSR切换模式, 此细节一般用于从中断返回.<br />
&nbsp;&nbsp;举几个中断返回的例子,<br />
&nbsp;&nbsp;未定义指令: MOVS PC, LR<br />
&nbsp;&nbsp;预取异常: SUBS PC, LR, #4 (中断时候加上的微小的, 无用的偏移量, 需要减去,才能返回到正确的地址)<br />
&nbsp;&nbsp;访存异常: SUBS PC, LR, #8 (中断时候加上的微小的, 无用的偏移量, 需要减去,才能返回到正确的地址)<br />
</td></tr></table>


</div>
<div id="comment_17682" class="cm">
</div>

<div id="post_rate_div_17682"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17682"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17682&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17682&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17682').innerHTML ? $('review_support_17682').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17682"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17682&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17682').innerHTML ? $('review_against_17682').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17682"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17682" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17682', 'misc.php?mod=report&rtype=post&rid=17682&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17682_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17682')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17683" ><table id="pid17683" class="plhin" summary="pid17683" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17683" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17683" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17683_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17683')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17683" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17683_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17683" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17683_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17683_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17683&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17683"   id="postnum17683" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>10</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17683" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17683">发表于 2019-6-27 11:34:30</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17683">
(* <font color="Red">乘法/乘加/长乘/长乘加法/符号长乘/符号长乘加法</font> 及机器码<br />
(*----******_*)<br />
<br />
&nbsp;&nbsp;MUL语法: Rd, Rm, Rs (乘法)<br />
&nbsp;&nbsp;MLA语法: Rd, Rm, Rs, Rn (乘加)<br />
&nbsp;&nbsp;UMULL语法 RdLo, RdHi, Rm, Rs (长乘)<br />
&nbsp;&nbsp;UMLAL语法 RdLo, RdHi, Rm, Rs (长乘加法)<br />
&nbsp;&nbsp;SMULL语法 RdLo, RdHi, Rm, Rs (符号长乘)<br />
&nbsp;&nbsp;SMLAL语法 RdLo, RdHi, Rm, Rs (符号长乘加法)<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;乘法很简单, 直接放机器码了<br />
&nbsp;&nbsp;27 26 25 24 23 22 21 20 19 - 16&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;15 - 12&nbsp; &nbsp;&nbsp;&nbsp;11 10 9 8&nbsp; &nbsp; 7 6 5 4&nbsp; &nbsp;&nbsp; &nbsp;3 2 1 0<br />
&nbsp; &nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;A&nbsp;&nbsp;S&nbsp; &nbsp; Rd&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Rn&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Rs&nbsp; &nbsp;&nbsp; &nbsp; 1 0 0 1&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Rm&nbsp; &nbsp;&nbsp; &nbsp; 乘法<br />
&nbsp; &nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;U&nbsp;&nbsp;A&nbsp;&nbsp;S&nbsp; &nbsp; RdHi&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; RdLo&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rs&nbsp; &nbsp;&nbsp; &nbsp; 1 0 0 1&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Rm&nbsp; &nbsp;&nbsp; &nbsp; 长乘<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;各乘法- 简要算法:<br />
&nbsp;&nbsp;UMULL &lt;- RdHi:RdLo := Rm*Rs<br />
&nbsp;&nbsp;USMULA &lt;- RdHi: Lo += Rm*Rs<br />
&nbsp;&nbsp;SMULL &lt;- RdHi:RdLo := Rm*Rs<br />
&nbsp;&nbsp;SMULA &lt;- RdHi:RdLo += Rm*Rs<br />
&nbsp;&nbsp;<br />
(* <font color="Red">指令跳转 </font>B/BL/BX 及机器码<br />
(*----******_*)<br />
&nbsp;&nbsp;B/BL语法: BL标号<br />
&nbsp;&nbsp;BX语法: BX寄存器<br />
&nbsp;&nbsp;编码1<br />
&nbsp;&nbsp;27 26 25 24&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;23 22 21 20 19 - 16 15 - 12 11 10 9 8 7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;L&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Offset (d23-d0)&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; B/BL 分支指令<br />
&nbsp; &nbsp;<br />
&nbsp;&nbsp;L:?下一条指令的PC(在V4版本芯片里这个地址为PC-4)会驻留在r14中:<br />
&nbsp;&nbsp;Offset是24位有符号偏移, 这个偏移需要符号扩展成30位再乘以4才是正在的偏移,<br />
&nbsp;&nbsp;PC在加上这段偏移,才是实际的跳转地址, (注意这里的PC,是当前执行指令处+8的PC)<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;编码2<br />
&nbsp;&nbsp;27 26 25 24 23 22 21 20 19 -&nbsp;&nbsp;16&nbsp;&nbsp;15 -&nbsp;&nbsp;12&nbsp; &nbsp; 11 10 9 8 7 6 5 4&nbsp; &nbsp;3 2 1 0<br />
&nbsp; &nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;1 1 1 1&nbsp; &nbsp;1 1 1 1&nbsp; &nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;1 1 1 0 0 0 1&nbsp; &nbsp;&nbsp;&nbsp;Rn&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;BX分支交换指令<br />
&nbsp; &nbsp;<br />
&nbsp;&nbsp;Rn[0]进Thumb标志位<br />
&nbsp;&nbsp;PC := Rn[0] &amp; 0xFFFFFFFE<br />
</td></tr></table>


</div>
<div id="comment_17683" class="cm">
</div>

<div id="post_rate_div_17683"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17683"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17683&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17683&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17683').innerHTML ? $('review_support_17683').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17683"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17683&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17683').innerHTML ? $('review_against_17683').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17683"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17683" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17683', 'misc.php?mod=report&rtype=post&rid=17683&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17683_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17683')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17684" ><table id="pid17684" class="plhin" summary="pid17684" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17684" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17684" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17684_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17684')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17684" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17684_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17684" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17684_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17684_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17684&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17684"   id="postnum17684" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>11</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17684" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17684">发表于 2019-6-27 11:35:13</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17684">
<font color="Red">(* CPSR/SPSR读写/SWI软件中断指令 及机器码</font><br />
(*----******_*)&nbsp;&nbsp;<br />
&nbsp;&nbsp;读写CPSR/SPSR<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;MRS是读PSR指令, 读指令只能读到寄存器里面<br />
&nbsp;&nbsp;MSR是写PSR指令, 写指令可以把立即数/寄存器的值写入PSR寄存器<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;MRS语法:<br />
&nbsp;&nbsp;PSR:= CPSR|SPSR<br />
&nbsp;&nbsp;MRS#Cond Rd, PSR<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;例子:<br />
&nbsp;&nbsp;MRSEQ R0, CPSR<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;MSR语法<br />
&nbsp;&nbsp;PSR:= CPSR|SPSR<br />
&nbsp;&nbsp;Field:= c|x|s|f (field的声言可以不重复叠加, 并且顺序无关)<br />
&nbsp;&nbsp;SRC:=8位位图+偶数移位立即数|寄存器<br />
&nbsp;&nbsp;MSR#Cond PSR#_#Field, SRC<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;例子:<br />
&nbsp;&nbsp;MSR CPSR_xfsc, R0<br />
&nbsp;&nbsp;MSR CPSR_xfcs, R0<br />
&nbsp;&nbsp;MSR CPSR_x, R0<br />
&nbsp;&nbsp;MSR SPSR_x, R0<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;掩码x:扩展位<br />
&nbsp;&nbsp;掩码c:控制位<br />
&nbsp;&nbsp;掩码s:状态位<br />
&nbsp;&nbsp;掩码f:标志位<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;对于写CPSR, 在用户模式只能修改标志位(掩码f), 在特权模式, 除了thumb标识无法修改外, 其余全可以根据标识需求符修改指定的位域.<br />
&nbsp;&nbsp;对于写SPSR, 无论何种模式, 所有位域皆可以修改.<br />
&nbsp;&nbsp;对于读SPSR/CPSR, 则是正常读取完整的Block块, <br />
&nbsp;&nbsp;(其实对于写CPSR, 标准ARM7TDMI芯片是不允许修改中断抑制标志的, GBA大概是改了一下吧. 详见 ARM手册 4.1.39 MSR指令的详细解释)<br />
&nbsp;&nbsp;CPSR/SPSR 的d4在操作过后总是会自动设置为1 .<br />
&nbsp;&nbsp;对于MSR写CPSR引起的切换模式, 会交换当前模式寄存器, 但不会发生当前CPSR保存到切换到的模式SPSR中. (此细节待测试).<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;MRS机器码<br />
&nbsp;&nbsp;-***********<br />
&nbsp;&nbsp;27 26 25 24 23 22 21 20 19 - 16 15 - 12 11 10 9 8 7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;R&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp; &nbsp;1111&nbsp; &nbsp; Rd&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;0 0 0 0 0 0 0 0 0 0 0<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;MSR立即数机器码<br />
&nbsp;&nbsp;-***********<br />
&nbsp;&nbsp;27 26 25 24 23 22 21 20 19 - 16 15 - 12 11 10 9 8 7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;R&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp; &nbsp;MASK&nbsp; &nbsp;&nbsp;&nbsp;1111 rotate_imm 8_bit_immediate<br />
&nbsp;&nbsp;MSR寄存器机器码<br />
&nbsp;&nbsp;-***********<br />
&nbsp;&nbsp;27 26 25 24 23 22 21 20 19 - 16 15 - 12 11 10 9 8 7 6 5 4&nbsp; &nbsp;3 2 1 0<br />
&nbsp; &nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;R&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp; &nbsp;MASK&nbsp; &nbsp;&nbsp;&nbsp;1111&nbsp;&nbsp;0&nbsp;&nbsp;0 0 0 0 0 0 0&nbsp; &nbsp;&nbsp; &nbsp;Rm<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;I对于PSR传输指示: 0-&gt;寄存器模式 1-&gt;立即数模式 (对于MRS总是为0,<br />
&nbsp;&nbsp;因为在ARM7中不存在 mrs imm8, cpsr/spsr这样的指令).<br />
&nbsp;&nbsp;d22指示加载/读取 0? CPSR:SPSR<br />
&nbsp;&nbsp;d21指示 0? MRS : MSR, 对于MSR写PSR寄存器,只能以位域掩码的形式写入,<br />
&nbsp;&nbsp;读取则是完整的读取整个PSR寄存器<br />
&nbsp;&nbsp;对于MRS, d12-d15指示了PSR加载到哪个寄存器<br />
&nbsp;&nbsp;对于MSR 有两种模式-I=0寄存器模式 d3-d0指示要写入CPSR/SPSR的源寄存器<br />
&nbsp;&nbsp;I=1立即数模式 d7-d0指示八位位图立即数, d8-d11指示供移动偶数位的4位移位量<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;可供MSR使用的掩码, 可组和使用:<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;d19 标志位 Bit 31-24<br />
&nbsp;&nbsp;d18 状态位 Bit 23-16&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(你不能动这个位域, 实质性的写入不会改变位域的内容,<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;ARM7这个位域不用.., &gt;=V6版本包含Simd浮点条件标记等..)<br />
&nbsp;&nbsp;d17 扩展位 Bit 15-8&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;(你不能动这个位域, 实质性的写入不会改变位域的内容,<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;ARM7这个位域不用.., &gt;=V6版本包含条件状态/大小端控制等..)<br />
&nbsp;&nbsp;d16 控制位 Bit 7-0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;软件中断, 在GBA, 这用于调用BIOS提供的软件中断<br />
&nbsp;&nbsp;语法 SWI Imm24<br />
&nbsp;&nbsp;27 26 25 24&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 23 22 21 20 19 - 16 15 - 12 11 10 9 8 7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;SWI Number (d23-d0) 软件中断<br />
&nbsp; &nbsp;<br />
&nbsp;&nbsp;具体的中断功能将在后面章节讲解<br />
&nbsp;&nbsp;至此所有标准的ARM7指令讲解完毕<br />
</td></tr></table>


</div>
<div id="comment_17684" class="cm">
</div>

<div id="post_rate_div_17684"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17684"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17684&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17684&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17684').innerHTML ? $('review_support_17684').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17684"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17684&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17684').innerHTML ? $('review_against_17684').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17684"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17684" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17684', 'misc.php?mod=report&rtype=post&rid=17684&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17684_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17684')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17685" ><table id="pid17685" class="plhin" summary="pid17685" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17685" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17685" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17685_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17685')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17685" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17685_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17685" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17685_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17685_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17685&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17685"   id="postnum17685" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>12</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17685" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17685">发表于 2019-6-27 11:39:29</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17685">
<font color="Red">---------------------------------------------------------CPU-THUMB指令---------------------------------------------------------------------</font></td></tr></table>


</div>
<div id="comment_17685" class="cm">
</div>

<div id="post_rate_div_17685"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17685"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17685&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17685&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17685').innerHTML ? $('review_support_17685').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17685"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17685&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17685').innerHTML ? $('review_against_17685').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17685"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17685" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17685', 'misc.php?mod=report&rtype=post&rid=17685&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17685_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17685')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17686" ><table id="pid17686" class="plhin" summary="pid17686" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17686" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17686" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17686_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17686')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17686" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17686_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17686" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17686_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17686_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17686&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17686"   id="postnum17686" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>13</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17686" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17686">发表于 2019-6-27 11:42:37</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17686">
<i class="pstatus"> 本帖最后由 moecmks 于 2019-6-27 11:43 编辑 </i><br />
<br />
<br />
&nbsp;&nbsp;<font color="#ff0000">(* 访存指令 LDR/STR/PUSH/POP/STMIA/LDMIA</font><br />
&nbsp;&nbsp;(*----******_*)&nbsp;&nbsp;<br />
&nbsp; &nbsp; 访存指令 LDR/STR/PUSH/POP/STMIA/LDMIA<br />
&nbsp; &nbsp; LDR/STR上面讲过了<br />
&nbsp; &nbsp; PUSH是DB类型栈操作<br />
&nbsp; &nbsp; POP则是IA类型栈操作<br />
&nbsp; &nbsp; STMIA/LDMIA 是用来拷存的.<br />
&nbsp; &nbsp; (* ------- LDR/STR ----- *)<br />
&nbsp; &nbsp;&nbsp; &nbsp;``````````````` LDR/STR<br />
&nbsp; &nbsp;&nbsp; &nbsp;语法1:&nbsp; &nbsp;&nbsp; &nbsp; LDR Rd, [Rn, #imm5*4]<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;LDRH Rd, [Rn, #imm5*2]<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;LDRB Rd, [Rn, #imm5*1]<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;STR Rd, [Rn, #imm5*4]<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;STRH Rd, [Rn, #imm5*2]<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;STRB Rd, [Rn, #imm5*1]<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;对于imm5*n的立即数偏移,必须对齐当前尺寸, 大部分编译器/汇编器也会限制这些语法(-4/-2/-1)<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;语法2:&nbsp; &nbsp;&nbsp; &nbsp; OP Rd, [Rn, Rm]<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;OP :&nbsp;&nbsp;= LDR|STR|LDRH|LDRSH|STRH|LDRB|LDRSB|STRB<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;语法3:&nbsp; &nbsp;&nbsp; &nbsp; LDR Rd, [pc, #imm8*4]<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;LDR Rd, label (这根LDR Rd, [pc, #imm8*4]一样的,只是语法不同, 其实暗示了此指令只能是正偏移, 只能加载指令后面的标号, 而且要对齐一个Word)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;LDR Rd, [sp, #imm8*4]<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;STR Rd, [sp, #imm8*4]<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;LDR/STR imm5机器码<br />
&nbsp; &nbsp;&nbsp; &nbsp;15 14 13 12 11&nbsp; &nbsp; 10 9 8 7 6&nbsp; &nbsp; 5 4 3&nbsp; &nbsp;2 1 0<br />
&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;B&nbsp;&nbsp;L&nbsp; &nbsp;&nbsp;&nbsp;Offset5&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Rn&nbsp; &nbsp;&nbsp;&nbsp;Rd 读写立即数偏移<br />
&nbsp; &nbsp;&nbsp; &nbsp; 1&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;L&nbsp; &nbsp;&nbsp;&nbsp;Offset5&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Rn&nbsp; &nbsp;&nbsp;&nbsp;Rd 读写halfword<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;L?LDR:&nbsp;&nbsp;STR<br />
&nbsp; &nbsp;&nbsp; &nbsp;B?指示字节:&nbsp;&nbsp;指示字<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;LDR/STR Rn, Rm 机器码<br />
&nbsp; &nbsp;&nbsp; &nbsp;15 14 13 12 11 10 9&nbsp; &nbsp; 8 7 6&nbsp; &nbsp; 5 4 3&nbsp; &nbsp; 2 1 0<br />
&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;L&nbsp;&nbsp;B 0&nbsp; &nbsp;&nbsp;&nbsp;Rm&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Rn&nbsp; &nbsp;&nbsp; &nbsp;Rd 读写相对+偏移<br />
&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;H&nbsp;&nbsp;S 1&nbsp; &nbsp;&nbsp;&nbsp;Rm&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Rn&nbsp; &nbsp;&nbsp; &nbsp;Rd 读写符号字节/halfword<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;L?LDR:&nbsp;&nbsp;STR<br />
&nbsp; &nbsp;&nbsp; &nbsp;B?字节:&nbsp;&nbsp;Word<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;H=0 S=0 STRH<br />
&nbsp; &nbsp;&nbsp; &nbsp;H=0 S=1 LDRSB<br />
&nbsp; &nbsp;&nbsp; &nbsp;H=1 S=0 LDRH<br />
&nbsp; &nbsp;&nbsp; &nbsp;H=1 S=1 LDRSH<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;LDR/STR SP/PC, #imm8*4 机器码<br />
&nbsp; &nbsp;&nbsp; &nbsp;15 14 13 12 11&nbsp; &nbsp;&nbsp;&nbsp;10 9&nbsp; &nbsp;&nbsp; &nbsp;8 7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp; &nbsp;&nbsp; &nbsp; Rd&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Offset8 读PC相对偏移<br />
&nbsp; &nbsp;&nbsp; &nbsp;15 14 13 12 11&nbsp; &nbsp;&nbsp;&nbsp;10 9&nbsp; &nbsp;&nbsp; &nbsp;8 7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;&nbsp; &nbsp; 1&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;L&nbsp; &nbsp;&nbsp; &nbsp; Rd&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Offset8 读写SP偏移<br />
&nbsp; &nbsp;&nbsp; &nbsp;L?LDR:&nbsp;&nbsp;STR<br />
&nbsp; &nbsp; (* ------- PUSH/POP ----- *)<br />
&nbsp; &nbsp;&nbsp; &nbsp;15 14 13 12 11 10 9 8&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;&nbsp; &nbsp; 1&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;L&nbsp;&nbsp;1 0 R&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rlist&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Push/Pop 寄存器<br />
&nbsp; &nbsp;&nbsp; &nbsp;L?POP:&nbsp;&nbsp;PUSH<br />
&nbsp; &nbsp;&nbsp; &nbsp;Rlist:&nbsp;&nbsp;寄存器列表, 跟ARM7的一样, 不同的是只有r0-r7可以入栈<br />
&nbsp; &nbsp;&nbsp; &nbsp;R要配合L使用, 对于PUSH, R:&nbsp;&nbsp;=1会额外PUSH LR寄存器, 对于POP, R:&nbsp;&nbsp;=1会额外POP到 PC里<br />
&nbsp; &nbsp;&nbsp; &nbsp;计算完成的地址会写回SP (废话....)<br />
&nbsp; &nbsp; (* ------- LDMIA/STMIA ----- *)<br />
&nbsp; &nbsp;&nbsp; &nbsp;15 14 13 12 11&nbsp; &nbsp;10 9 8&nbsp; &nbsp; 7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;&nbsp; &nbsp; 1&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;L&nbsp; &nbsp;&nbsp;&nbsp;Rn&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Rlist&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;寄存器栈操作<br />
&nbsp; &nbsp;&nbsp; &nbsp;L?LDMIA:&nbsp;&nbsp;STMIA<br />
&nbsp; &nbsp;&nbsp; &nbsp;注意计算完成获得的地址一定会写回Rn<br />
</td></tr></table>


</div>
<div id="comment_17686" class="cm">
</div>

<div id="post_rate_div_17686"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17686"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17686&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17686&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17686').innerHTML ? $('review_support_17686').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17686"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17686&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17686').innerHTML ? $('review_against_17686').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17686"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17686" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17686', 'misc.php?mod=report&rtype=post&rid=17686&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17686_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17686')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17687" ><table id="pid17687" class="plhin" summary="pid17687" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17687" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17687" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17687_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17687')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17687" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17687_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17687" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17687_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17687_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17687&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17687"   id="postnum17687" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>14</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17687" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17687">发表于 2019-6-27 11:45:47</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17687">
<br />
&nbsp;&nbsp;(* <font color="Red">THUMB 主ALU指令</font>, 机器码没有S标志位, 但是一定会设置标志...<br />
&nbsp;&nbsp;(*----******_*)<br />
&nbsp; &nbsp;&nbsp; &nbsp;15 14 13 12 11 10&nbsp; &nbsp;&nbsp; &nbsp;9 8 7 6&nbsp; &nbsp;&nbsp; &nbsp;5 4 3&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;2 1 0<br />
&nbsp; &nbsp;&nbsp; &nbsp; 0&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Op(4bit)&nbsp; &nbsp;Rm/Rs&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Rd/Rn<br />
&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;Op:&nbsp;&nbsp;0000&lt;- AND Rd, Rm NZ-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0001&lt;- EOR Rd, Rm NZ-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0010&lt;- LSL Rd, Rs NZC-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0011&lt;- LSR Rd, Rs NZC-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0100&lt;- ASR Rd, Rs NZC-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0101&lt;- ADC Rd, Rm NZCV<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0110&lt;- SBC Rd, Rm NZCV<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 0111&lt;- ROR Rd, Rs NZC-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1000&lt;- TST Rn, Rm NZ-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1001&lt;- NEG Rd, Rm NZCV, 等同于 rd: = 0-rm<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1010&lt;- CMP Rn, Rm NZCV<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1011&lt;- CMN Rn, Rm NZCV<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1100&lt;- ORR Rd, Rm NZ-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1101&lt;- MUL Rd, Rm NZ-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1110&lt;- BIC Rd, Rm NZ-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1111&lt;- MVN Rd, Rm NZ-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;(* <font color="Red">THUMB 扩展ALU指令</font><br />
&nbsp;&nbsp;(*----******_*)&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp; 机器码1<br />
&nbsp; &nbsp; 15 14 13&nbsp; &nbsp; 12 11&nbsp; &nbsp;10 9 8 7 6&nbsp; &nbsp;5 4 3&nbsp; &nbsp;2 1 0<br />
&nbsp; &nbsp;&nbsp; &nbsp;0 0&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;Op&nbsp; &nbsp;&nbsp; &nbsp;Offset5&nbsp; &nbsp;&nbsp;&nbsp;Rm&nbsp; &nbsp;&nbsp; &nbsp;Rd<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp; Op:&nbsp;&nbsp;00 &lt;- LSL<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;01 &lt;- LSR<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;10 &lt;- ASR<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;11 &lt;- NULL, 没有,或者是另外的指令<br />
&nbsp; &nbsp; 影响 NZC-<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; 机器码2<br />
&nbsp; &nbsp; 15 14 13 12 11 10&nbsp; &nbsp;&nbsp;&nbsp;9&nbsp; &nbsp;&nbsp; &nbsp;8 7 6&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 5 4 3&nbsp; &nbsp;&nbsp;&nbsp;2 1 0<br />
&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;I&nbsp; &nbsp; Op&nbsp; &nbsp;&nbsp; &nbsp;Rm/offset3&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rn&nbsp; &nbsp;&nbsp; &nbsp; Rd<br />
&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp; I?3位立即数: 寄存器<br />
&nbsp; &nbsp; OP?Sub: Add<br />
&nbsp; &nbsp; 影响 NZCV<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp; 机器码3<br />
&nbsp; &nbsp; 15 14 13&nbsp; &nbsp; 12 11&nbsp; &nbsp;10 9 8&nbsp; &nbsp;7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;Op&nbsp; &nbsp;&nbsp;&nbsp;Rd/Rn&nbsp; &nbsp; Offset8 (d7-d0)<br />
&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp; Op: 00&lt;- MOV NZ-<br />
&nbsp; &nbsp;&nbsp; &nbsp; 01&lt;- CMP NZCV<br />
&nbsp; &nbsp;&nbsp; &nbsp; 10&lt;- ADD NZCV<br />
&nbsp; &nbsp;&nbsp; &nbsp; 11&lt;- SUB NZCV&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp; 机器码4<br />
&nbsp; &nbsp; 15 14 13 12 11 10&nbsp; &nbsp;9 8&nbsp; &nbsp;7&nbsp;&nbsp;6&nbsp; &nbsp;5 4 3&nbsp; &nbsp; 2 1 0<br />
&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp; &nbsp;Op&nbsp; &nbsp; H1 H2&nbsp; &nbsp; Rm&nbsp; &nbsp;&nbsp;&nbsp;Rd/Rn<br />
&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp; Op:&nbsp;&nbsp;00 &lt;- ADD Rd, Rm - 不影响标志位<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;01 &lt;- CMP Rn, Rm - NZCV<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;10 &lt;- MOV Rd, Rm - 不影响标志位<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;11 &lt;- BX Rm<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp; H1是Rn的高位, 和3位Rn变成4位寻址r0-r15<br />
&nbsp; &nbsp; H2是Rm的高位, 和3位Rm变成4位寻址r0-r15<br />
&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp; 机器码5 ADD Rd, SP/PC*Imm8*4<br />
&nbsp; &nbsp; 15 14 13 12 11&nbsp; &nbsp; 10 9 8&nbsp; &nbsp; 7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;0 SP&nbsp; &nbsp;&nbsp; &nbsp; Rd&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;Imm8<br />
&nbsp; &nbsp; SP?: SP: PC<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; 机器码6 ADD/SUB SP, Imm7*4<br />
&nbsp; &nbsp; 15 14 13 12 11 10 9 8 7&nbsp; &nbsp;6 5 4 3 2 1 0<br />
&nbsp; &nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;0 0 0 S&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Imm7<br />
&nbsp; &nbsp; S?: SUB: ADD</td></tr></table>


</div>
<div id="comment_17687" class="cm">
</div>

<div id="post_rate_div_17687"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17687"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17687&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17687&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17687').innerHTML ? $('review_support_17687').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17687"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17687&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17687').innerHTML ? $('review_against_17687').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17687"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17687" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17687', 'misc.php?mod=report&rtype=post&rid=17687&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17687_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17687')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17688" ><table id="pid17688" class="plhin" summary="pid17688" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17688" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17688" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17688_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17688')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17688" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17688_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17688" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17688_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17688_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17688&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17688"   id="postnum17688" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>15</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17688" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17688">发表于 2019-6-27 11:46:17</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17688">
&nbsp;&nbsp;(* <font color="Red">THUMB 条件分支</font><br />
&nbsp;&nbsp;(*----******_*)&nbsp; &nbsp;<br />
&nbsp; &nbsp; 15 14 13 12&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 11 10 9 8&nbsp; &nbsp;&nbsp; &nbsp;7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Cond(4bit)&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;SImm8&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;B Cond 条件分支<br />
&nbsp; &nbsp; 寻址计算 PC: =PC+ movsx(Imm8)&lt;&lt;1<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; 15 14 13 12 11&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 10 9 8 7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Offset11&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; B无条件分支<br />
&nbsp; &nbsp; 寻址计算 PC: =PC+ movsx(Imm11)&lt;&lt;1<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; 15 14 13 12 11&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;10 9 8 7 6 5 4 3 2 1 0<br />
&nbsp; &nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;1&nbsp;&nbsp;H&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Imm11&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; BL长偏移分支<br />
&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp; 长偏移被编码成两条指令<br />
&nbsp; &nbsp; H=0是第一条指令<br />
&nbsp; &nbsp; LR = PC + (movsx(SImm11) &lt;&lt; 12)<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; H=1是第二条指令<br />
&nbsp; &nbsp; PC = LR + (Imm11 &lt;&lt; 1)<br />
&nbsp; &nbsp; LR = 下一条指令地址 | 1<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; 15 14 13 12 11 10 9 8&nbsp;&nbsp;7&nbsp;&nbsp;6&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5 4 3&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2 1 0 BX Rm<br />
&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;&nbsp;1 1 1 H1 H2&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Rm&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Rd/Rn<br />
&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp; 实际上扩展ALU指令机器码4 OP: =11情况<br />
&nbsp; &nbsp; Rm注意是Rm不是Rn, Rm的0位进T标志位域<br />
&nbsp; &nbsp; 然后PC: = Rm &amp; -2<br />
&nbsp; &nbsp; </td></tr></table>


</div>
<div id="comment_17688" class="cm">
</div>

<div id="post_rate_div_17688"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17688"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17688&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17688&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17688').innerHTML ? $('review_support_17688').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17688"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17688&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17688').innerHTML ? $('review_against_17688').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17688"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17688" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17688', 'misc.php?mod=report&rtype=post&rid=17688&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17688_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17688')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17689" ><table id="pid17689" class="plhin" summary="pid17689" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17689" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17689" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17689_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17689')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17689" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17689_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17689" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17689_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17689_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17689&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17689"   id="postnum17689" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>16</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17689" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17689">发表于 2019-6-27 11:47:26</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17689">
<font color="Red">---------------------------------------------------------CPU-指令周期概览---------------------------------------------------------------------</font></td></tr></table>


</div>
<div id="comment_17689" class="cm">
</div>

<div id="post_rate_div_17689"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17689"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17689&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17689&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17689').innerHTML ? $('review_support_17689').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17689"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17689&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17689').innerHTML ? $('review_against_17689').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17689"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17689" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17689', 'misc.php?mod=report&rtype=post&rid=17689&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17689_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17689')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17690" ><table id="pid17690" class="plhin" summary="pid17690" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17690" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17690" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17690_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17690')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17690" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17690_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17690" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17690_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17690_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17690&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17690"   id="postnum17690" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>17</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17690" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17690">发表于 2019-6-27 11:47:45</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17690">
{ ====== <font color="#ff0000">指令周期概览</font> ======== }<br />
&nbsp; &nbsp; ALU指令 S +I for SHIFT(Rs) +S + N if R15 written<br />
&nbsp; &nbsp; MSR, MRS S<br />
&nbsp; &nbsp; LDR S+N+I +S +N if R15 loaded<br />
&nbsp; &nbsp; STR 2N<br />
&nbsp; &nbsp; LDM nS+N+I +S +N if R15 loaded<br />
&nbsp; &nbsp; STM (n-1)S+2N<br />
&nbsp; &nbsp; SWP S+2N+I<br />
&nbsp; &nbsp; B,BL 2S+N<br />
&nbsp; &nbsp; SWI, trap 2S+N<br />
&nbsp; &nbsp; MUL S+mI<br />
&nbsp; &nbsp; MLA S+(m+1)I<br />
&nbsp; &nbsp; MULL S+(m+1)I<br />
&nbsp; &nbsp; MLAL S+(m+2)I<br />
&nbsp; &nbsp; S: 连续周期<br />
&nbsp; &nbsp; N: 非连续周期<br />
&nbsp; &nbsp; I: 内部周期<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; 乘法的m周期计算: <br />
&nbsp; &nbsp; 对于乘法实际就是移位相加的组合<br />
&nbsp; &nbsp; 乘法周期的计算主要依赖于Rs移位寄存器的内部字节信息.<br />
&nbsp; &nbsp; 按照 d31 -&gt; d0的方向 拆分成 四个字节<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; Block3 - Block2 - Block1 - Block0<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; if ((int32_t) Rs &lt; 0)<br />
&nbsp; &nbsp; Rs = ~Rs;<br />
&nbsp; &nbsp; Block 3- 1全为0 则 m: = 1<br />
&nbsp; &nbsp; Block 3- 2全为0 则 m: = 2<br />
&nbsp; &nbsp; Block 3为0 则 m: =3<br />
&nbsp; &nbsp; 全部不为0, 那么m: = 4<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; 对于取指, 实际需要的时间与当前设备的cache状态有关<br />
&nbsp; &nbsp; 缓存线内部有相应的cache数据, 则不需要额外的访存时间,<br />
&nbsp; &nbsp; 缓存脱靶时需要的时间 (WaitState) 依赖GBA内部IO指定的WaitState和当前周期类型<br />
&nbsp; &nbsp; 注意这个缓存只适用于取指(指令cache)<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; 对于STR/STM, 他的最后一个周期总是指示下一条指令的预取是N周期.<br />
&nbsp; &nbsp; <br />
{ ====== <font color="#ff0000">未对齐的读写访问UB行为</font> ======== }<br />
&nbsp; &nbsp; 一般情况下都是下降对齐地址在取值, 当然, 也会有特殊情况<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; 对于 未对齐的LDR: 来说,先下降内存对齐4字节, 然后取出的值: = 值 ROR循环移位 (address &amp; 3) * 8 位<br />
&nbsp; &nbsp; 对于 未对齐的LDRH: 来说,先下降内存对齐2字节, 然后取出的值: = 值 ROR循环移位&nbsp;&nbsp;8 位 (例子 r0 : = r1 ror 8)<br />
&nbsp; &nbsp; 对于 未对齐的LDRSH: 来说,取出的值: = 取未对齐的原始地址单字节有符号扩展为32位 <br />
&nbsp; &nbsp; SWP[B]指令的未对齐行为, 同LDR[B]/ STR[B]<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; 第一条引用于ARM手册 arm_arm.pdf : :&nbsp;&nbsp;A4.1.23 LDR Alignment 章节解释<br />
&nbsp; &nbsp; 剩下的引用于GBA模拟器no cashGBA的GBATEK的ARM章节. (因为在官方手册中没找到记载, 直接用UB行为敷衍了事了)<br />
{ ====== <font color="#ff0000">资料参考</font>. =========== }<br />
&nbsp; &nbsp; ARM Developer Suite Assembler Guide (DUI0068.pdf, ARM通用汇编编程手册, 提供快速的指令参考, 用户层面的参考书)<br />
&nbsp; &nbsp; ARM7TDMI Technical Reference Manual (DDI0210B.pdf, 此文档包含详细的ARM7TDMI指令周期时序, 和简略的操作码表)<br />
&nbsp; &nbsp; ARM Architecture Reference Manual (arm_arm.pdf, 这个是最全的芯片细节解释, 提供最详细的操作码机器码解码流程)<br />
&nbsp; &nbsp; 上海交大 ARM7TDMI总线接口 (不错的中文教程).<br />
&nbsp; &nbsp; NO CASH GBA模拟器文档 GBATEK (关于未对齐的指令解释很详细)</td></tr></table>


</div>
<div id="comment_17690" class="cm">
</div>

<div id="post_rate_div_17690"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17690"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17690&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17690&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17690').innerHTML ? $('review_support_17690').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17690"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17690&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17690').innerHTML ? $('review_against_17690').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17690"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17690" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17690', 'misc.php?mod=report&rtype=post&rid=17690&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17690_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17690')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17691" ><table id="pid17691" class="plhin" summary="pid17691" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17691" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17691" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17691_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17691')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17691" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17691_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17691" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17691_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17691_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17691&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17691"   id="postnum17691" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>18</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17691" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17691">发表于 2019-6-27 11:54:07</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17691">
<i class="pstatus"> 本帖最后由 moecmks 于 2019-6-27 12:06 编辑 </i><br />
<br />
<font color="Red">---------------------------------------------------------ARM7-THUMB指令码表---------------------------------------------------------------------</font><img id="aimg_Z8zw8" onclick="zoom(this, this.src, 0, 0, 0)" class="zoom" src="https://s2.ax1x.com/2019/06/27/Zn3ti9.png" onmouseover="img_onmouseoverfunc(this)" onload="thumbImg(this)" border="0" alt="" /><br />
<img id="aimg_lH8pz" onclick="zoom(this, this.src, 0, 0, 0)" class="zoom" width="600" height="493" src="https://s2.ax1x.com/2019/06/27/Zn3cid.png" onmouseover="img_onmouseoverfunc(this)" onclick="zoom(this)" style="cursor:pointer" border="0" alt="" /><br />
图表是我在adobe pdf里编辑的,凑合着看吧, <br />
<br />
注意GBA所使用的ARM7废弃了浮点处理指令, 所以我们可以不用去管浮点指令的解码<br />
貌似忘了说 thumb 模式的swi软中断指令了, 跟arm7一样, 只是操作位数变短了, 机器码在表里,不多说了<br />
<br />
<br />
<br />
<br />
</td></tr></table>


</div>
<div id="comment_17691" class="cm">
</div>

<div id="post_rate_div_17691"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17691"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17691&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17691&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17691').innerHTML ? $('review_support_17691').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17691"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17691&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17691').innerHTML ? $('review_against_17691').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17691"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17691" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17691', 'misc.php?mod=report&rtype=post&rid=17691&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17691_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17691')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
<script type="text/javascript" reload="1">
aimgcount[17691] = ['Z8zw8','lH8pz'];
attachimggroup(17691);
attachimgshow(17691);
var aimgfid = 0;
</script>
</div><div id="post_17692" ><table id="pid17692" class="plhin" summary="pid17692" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17692" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17692" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17692_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17692')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17692" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17692_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17692" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17692_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17692_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17692&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17692"   id="postnum17692" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>19</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17692" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17692">发表于 2019-6-27 12:12:01</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17692">
ARM7TDMI源码实现见附件, 应该没啥大问题..之后就说GPU, GPU讲完就简单啦<br />
</td></tr></table>

<div class="attach_nopermission attach_tips">
<div>
<h3><strong>本帖子中包含更多资源</strong></h3>
<p>您需要 <a href="https://cpp.ra2diy.com/member.php?mod=logging&action=login" onclick="showWindow('login', this.href);return false;">登录</a> 才可以下载或查看，没有帐号？<a href="https://cpp.ra2diy.com/member.php?mod=register" title="注册帐号">立即注册</a> </p>
</div>
<span class="atips_close" onclick="this.parentNode.style.display='none'">x</span>
</div>

</div>
<div id="comment_17692" class="cm">
</div>

<div id="post_rate_div_17692"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17692"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17692&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17692&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17692').innerHTML ? $('review_support_17692').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17692"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17692&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17692').innerHTML ? $('review_against_17692').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17692"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17692" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17692', 'misc.php?mod=report&rtype=post&rid=17692&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17692_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17692')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17693" ><table id="pid17693" class="plhin" summary="pid17693" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17693" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17693" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17693_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17693')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17693" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17693_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17693" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17693_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17693_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17693&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17693"   id="postnum17693" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>20</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17693" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17693">发表于 2019-6-27 12:14:53</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17693">
<i class="pstatus"> 本帖最后由 moecmks 于 2019-6-27 14:19 编辑 </i><br />
<br />
<font color="Red">---------------------------------------------------------GPU-卷轴---------------------------------------------------------------------</font></td></tr></table>


</div>
<div id="comment_17693" class="cm">
</div>

<div id="post_rate_div_17693"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17693"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17693&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17693&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17693').innerHTML ? $('review_support_17693').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17693"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17693&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17693').innerHTML ? $('review_against_17693').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17693"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17693" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17693', 'misc.php?mod=report&rtype=post&rid=17693&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17693_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17693')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17694" ><table id="pid17694" class="plhin" summary="pid17694" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17694" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17694" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17694_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17694')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17694" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17694_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17694" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17694_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17694_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17694&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17694"   id="postnum17694" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>21</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17694" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17694">发表于 2019-6-27 14:03:26</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17694">
<i class="pstatus"> 本帖最后由 moecmks 于 2019-6-27 14:12 编辑 </i><br />
<br />
GPU复杂的很 <br />
首先 GBA从渲染对象可分为 卷轴(命名表) 和OAM (精灵)<br />
GBA有四个卷轴渲染器, 一个128个可供渲染精灵 <br />
支持 Alpha混合, 增亮, 变暗, 马赛克, 透明像素, 垂直水平翻转等等一些基本的图形效果<br />
对于整个渲染屏幕来说, 还可以把当前渲染对象分成两份, 进行裁剪和镂空<br />
以及支持简单的2D仿射来模拟简单的 &quot;3D&quot;渲染 <br />
这些机能对于现在大部分2D游戏来说都已经够用了,<br />
唯二的缺点是CPU,和颜色, GBA只支持16位颜色和调色板模式 <br />
<br />
先说卷轴渲染器 (BG0 ~ BG3), 卷轴渲染器支持6种模式渲染(mode 0 ~ mode 5), 其中大部分游戏只用到 mode 0 ~ mode 2<br />
<br />
! mode 0, BG 0 ~ BG3 皆可以使用, 每个卷轴都可以做四分屏渲染 (512 * 512), 可切换 8位, 4位像素渲染模式 <br />
! mode 1, BG 0 ~ BG1 做标准渲染, BG2 做仿射变换渲染, BG 3不使用<br />
! mode 2, BG2, BG3 做仿射变换渲染, BG 0, BG1 不使用<br />
<br />
卷轴模式也就这三种比较难以理解, 其余的模式非常好理解, 先不讲 <br />
类似于GBA, NES这些Console游戏都非常节省内存, <br />
大家都知道图像是2D游戏内的大头数据,<br />
而这些数据如果颜色有限,可以用调色板索引节省内存, 对吧?<br />
对于Console游戏, 可能会根据某种线性关系再次压缩调色板索引位数<br />
所以Console游戏的容量往往都很小<br />
<br />
&lt;命名表&gt; 对于 mode 0 ~ mode 2 卷轴渲染来说 <br />
显存里面有个叫命名表(nametable) 的东西, 这个命名表是一块大的内存的集合,<br />
每两个字节(仿射BG一个字节)代表着命名表的一个item <br />
item 存载着 一个叫Tile ID的东西和一些其他的属性<br />
这个Tile ID是一个索引编号, 每一个索引编号, 可以寻址到一个 8 * 8 的chr 字符像素组 <img id="aimg_Eqm5t" onclick="zoom(this, this.src, 0, 0, 0)" class="zoom" src="https://s2.ax1x.com/2019/06/27/ZnrJ8f.png" onmouseover="img_onmouseoverfunc(this)" onload="thumbImg(this)" border="0" alt="" /><br />
<br />
这个字符像素组, 对于 8位调色板像素来说是64个字节为一组, 4位则是32个字节<br />
对于标准渲染来说, 一个命名表的尺寸为 32 * 32个 Item, 可以有 1 (256 * 256), 2 (512 * 256水平镜像, 256 * 512 垂直镜像), 4个命名表 (四分屏镜像)<br />
对于仿射渲染来说, 只有一个命名表, 这个命名表为正矩形, 长宽可有, 16 (128), 32(256), 64(512), 128 (1024) 个item<br />
屏幕渲染会根据这些命名表的item里的 Tile ID, 把当前尺寸的命名表寻址到的像素全部着色, <br />
然后根据可被设置的滚动X, Y POS裁剪成240 * 160 (GBA屏幕的尺寸)显示出来 <br />
<br />
实际处理当中我们只需要根据滚动位置渲染240 * 160 像素就行了 <br />
卷轴在到达边界会回滚至0处, 请注意 <br />
<br />
<br />
命名表双字节 Item 属性 <br />
<br />
d9- d0 tile 号码, <br />
d10- 水平反转致能<br />
d11- 垂直反转致能<br />
d15-d12- 4位调色板 bank, 适用于4位tile渲染模式, 这个bank是是BG调色板16*bank的对齐地址16位的调色板的首地址, 用来配合4位chr寻址颜色<br />
<br />
命名表单字节 Item 属性 <br />
8位全部代码 tile id <br />
<br />
&lt;chr表&gt; <br />
chr 表<br />
chr 存放着可被命名表索引的实际的像素堆, <br />
每个命名表链接着一个在显存内的像素堆的首地址, <br />
然后以 8位 64个字节为一个item, 4位32个字节为一个item的偏移存放<br />
对于8位调色板, 像素布列如图 <br />
........&nbsp; &nbsp;&nbsp;&nbsp;0~ 7<br />
........&nbsp; &nbsp;&nbsp;&nbsp;8~15<br />
.<br />
.<br />
........&nbsp; &nbsp;&nbsp;&nbsp;56~63<br />
<br />
<br />
对于4位调色板, 像素布列如图 <br />
........&nbsp; &nbsp;&nbsp;&nbsp;0~3 字节低位为左, 高位为右<br />
........&nbsp; &nbsp;&nbsp;&nbsp;4~7<br />
.<br />
.<br />
........&nbsp; &nbsp;&nbsp;&nbsp;28~31<br />
<br />
寻址:= chr首地址 *tile id * 64 or 32 <br />
</td></tr></table>


</div>
<div id="comment_17694" class="cm">
</div>

<div id="post_rate_div_17694"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17694"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17694&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17694&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17694').innerHTML ? $('review_support_17694').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17694"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17694&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17694').innerHTML ? $('review_against_17694').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17694"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17694" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17694', 'misc.php?mod=report&rtype=post&rid=17694&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17694_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17694')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
<script type="text/javascript" reload="1">
aimgcount[17694] = ['Eqm5t'];
attachimggroup(17694);
attachimgshow(17694);
var aimgfid = 0;
</script>
</div><div id="post_17695" ><table id="pid17695" class="plhin" summary="pid17695" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17695" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17695" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17695_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17695')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17695" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17695_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17695" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17695_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17695_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17695&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17695"   id="postnum17695" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>22</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17695" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17695">发表于 2019-6-27 14:12:27</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17695">
<i class="pstatus"> 本帖最后由 moecmks 于 2019-6-27 14:15 编辑 </i><br />
<br />
(* <font color="Red">仿射变换卷轴</font> *)<br />
GBA的GPU提供简单的仿射变换功能<br />
<br />
主要由以下10个参数设置 (这八个参数全是有符号的并且低8位都不是整数(用来模拟小数))<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dx (PA), int16_t<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dmx (PB), int16_t<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dy (PC), int16_t<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dmy (PC), int16_t<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ref_x, int28_t (d27位为符号位, 下面以此类推)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ref_y, int28_t&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dmx_total, int28_t&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dmy_total, int28_t&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dx_temp, int28_t <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dy_temp, int28_t <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;在 VBLANK开始的时候 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dmx_total := ref_x<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dmy_total := ref_y&nbsp; &nbsp;<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;之后从扫描线 0~159间的每次扫描线切换到下一根扫描线的时候 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dx_temp = dmx_total<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dy_temp = dmx_total&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dmx_total += dmx<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dmy_total += dmy&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;然后每次水平扫描的时候每渐进一个像素点, <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dx_temp += dx <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;dy_temp += dy <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;这个dx_temp, dy_temp把低8位非整数右移掉就是当前渲染的卷轴落点范围<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;就这么简单, <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;注意, 非VBLANK期间写入 ref_x, ref_y也会使相应的单个 dmx_total/dmy_total更新 (dmx_total := ref_x/ dmy_total := ref_y)VBLANK, 下面在解释,你可以理解成一个关键的契机,时间序列点<br />
</td></tr></table>


</div>
<div id="comment_17695" class="cm">
</div>

<div id="post_rate_div_17695"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17695"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17695&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17695&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17695').innerHTML ? $('review_support_17695').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17695"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17695&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17695').innerHTML ? $('review_against_17695').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17695"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17695" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17695', 'misc.php?mod=report&rtype=post&rid=17695&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17695_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17695')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17696" ><table id="pid17696" class="plhin" summary="pid17696" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17696" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17696" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17696_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17696')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17696" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17696_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17696" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17696_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17696_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17696&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17696"   id="postnum17696" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>23</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17696" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17696">发表于 2019-6-27 17:06:15</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17696">
<font color="Red">---------------------------------------------------------OAM---------------------------------------------------------------------</font></td></tr></table>


</div>
<div id="comment_17696" class="cm">
</div>

<div id="post_rate_div_17696"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17696"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17696&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17696&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17696').innerHTML ? $('review_support_17696').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17696"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17696&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17696').innerHTML ? $('review_against_17696').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17696"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17696" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17696', 'misc.php?mod=report&rtype=post&rid=17696&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17696_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17696')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17697" ><table id="pid17697" class="plhin" summary="pid17697" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17697" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17697" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17697_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17697')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17697" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17697_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17697" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17697_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17697_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17697&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17697"   id="postnum17697" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>24</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17697" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17697">发表于 2019-6-27 17:07:36</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17697">
<i class="pstatus"> 本帖最后由 moecmks 于 2019-6-27 17:09 编辑 </i><br />
<br />
(* 精灵(<font color="#ff0000">OAM</font>), 精灵有块在显存0x6010000处的32K固定字符表, 配合精灵的Tile-ID寻址到实际的像素 *)&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;GBA的精灵也是十分复杂, 并且也可以切换渲染模式-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;精灵的最小像素单元也是一个8*8的Tile, <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;但是精灵有能像&quot;胶水&quot;一样把多个Tile块拼合在一起显示的能力.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;一个精灵可以显示多种尺寸的Tile合集,<br />
&nbsp; &nbsp;(* 精灵的TILE-ID寻址*)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;精灵只有4位精灵和8位精灵两种<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;精灵的属性内存只提供一个Tile块合集的最上角POS(0, 0)的精灵 TileID.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;对于精灵的水平方向寻址:4位精灵每次加上此行TileID基地址+1<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;8位精灵每次加上此行TileID基地址+2<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;行TileID基地址寻址有两种模式可被GPU随意切换-<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;固定步长32寻址 -&gt;无论8位/4位, 每次切换到下一个完整的Block8 Tile渲染时, 都随当前行基地址+= 32<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;如图:<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;8位模式固定位长寻址: TILE-ID := 16, 16*16<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;16 | 18 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;48 | 50 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;4位模式固定位长寻址: TILE-ID := 16, 16*16<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;16 | 17 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;48 | 49&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;自身连续寻址: 举个例子:<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;一个32*16的4位精灵, TildID := 55 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;55 | 56 | 57 | 58 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;59 | 60 | 61 | 62&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;(* <font color="#ff0000">精灵的CHR寻址</font>*)&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;有了Tile ID, 便可寻址到具体的像素字符表 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;无论像素位数是4还是8位, 都是一个4位Tile的完整Block增量, 这个跟BG Tile寻址不一样(+32)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;比如对于寻址 TildID:= 277的Tile, 4位只要写 277, 但是8位就要变成277*2 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;对于8位Tile寻址, 最后一位会被忽略<br />
&nbsp; &nbsp;(* <font color="#ff0000">精灵的完整寻址例子</font>*)&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;举个例子:= <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;8位模式固定位长寻址: TILE-ID := 99, 32*16<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;| 99&nbsp; &nbsp; | 101&nbsp; &nbsp; |<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;| 99+32 | 101 +32| ---&gt; | A | B |<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;| C | D | <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;对于A处的寻址, TildID := 99, 因为是8位忽略最低位, := 98 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;TilePixel_8_8_Start := 0x6010000 + 98*32 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;对于B处的寻址, TildID := 101, 因为是8位忽略最低位, := 100 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;TilePixel_8_8_Start := 0x6010000 + 100*32<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;...<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;...<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;以此类推<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp; (* <font color="#ff0000">精灵的仿射</font>*)&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;精灵也有仿射功能, <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 精灵仿射的坐标系如下:<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Y Negtive<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;/|\ <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; |<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; |<br />
X Negtive &lt;-&nbsp;&nbsp;-----|-----&nbsp;&nbsp;-&gt; X Postive <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; |\<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; | \_____________ Origin (0, 0) 精灵的中心点<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;\|/<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Y Postive<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 对于精灵仿射只有 dx, dmx, dy, dmy 这四个参数使用.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 这四个参数跟BG用的那四个参数是一样的...<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; BG实际是用了这个坐标系右下角的象限进行仿射变换的.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 对于GBA游戏机来说, 精灵的渲染坐标确定遵循以下公式<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;x0, y0&nbsp; &nbsp; 旋转中心点, 也即是精灵的中心点坐标<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;x1, y1&nbsp; &nbsp; 当前需要扫描线渲染的坐标<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;x2, y2&nbsp; &nbsp; 实际经过仿射变换获得的坐标<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;A, B, C, D&nbsp;&nbsp;dx, dmx, dy, dmy <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;x2 = A(x1-x0) + B(y1-y0) + x0<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;y2 = C(x1-x0) + D(y1-y0) + y0<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;这个公式其实很简单, 其实寻址都是相对于中心点向量带符号偏移(水平, 垂直方向) 的比例系数<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;游戏机就会根据这个公式计算当前坐标仿射过后的实际的像素落点,<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;超过范围不会被处理, 比如在 POS (8, 8)处的一个32*32的精灵<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;经过计算落点在 (166, 166)处, 超过本身的(8~39, 8~39)范围, 忽略处理这个像素<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;如果落点在这个范围, 怎么计算这个像素呢, <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;减去初始偏移即可, 比如落点27, 16 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; X偏移:= 27-8 := 19/8 := 2..3<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Y偏移:= 16-8 := 8/8 := 1...0<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 那么就会寻址 POS (2, 1)内8*8Tile POS(3.0)的像素....<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 以此类推<br />
&nbsp; &nbsp; (* <font color="#ff0000">双倍尺寸精灵</font>*)&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;这个所谓的双倍是对于仿射精灵来说的, 是双倍的画布模式, 不是原始像素放大两倍.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;举个例子, 比如一个正矩形, 可被渲染区域就是整个矩形的区域,<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;你把它旋转45度, 就会有部分像素跑到区域外不被显示了, 怎么办?<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;我想显示这部分像素怎么办呢? 把显示画布区域调大点不就行了?<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;双倍精灵就是这个意思.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;对于双倍精灵来说, 中线点X, Y坐标会被增加一个水平, 垂直尺寸一半的尺寸.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;然后两个方向各扩展一半画布尺寸,然后按照正常的仿射套路渲染<br />
&nbsp; &nbsp; (* <font color="#ff0000">双倍尺寸精灵BUG</font> *)&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;当启用双倍精灵时, 对于此精灵, 如果有像素处于128~160这个范围, 这个范围的像素不会被显示.<br />
</td></tr></table>


</div>
<div id="comment_17697" class="cm">
</div>

<div id="post_rate_div_17697"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17697"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17697&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17697&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17697').innerHTML ? $('review_support_17697').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17697"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17697&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17697').innerHTML ? $('review_against_17697').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17697"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17697" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17697', 'misc.php?mod=report&rtype=post&rid=17697&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17697_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17697')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17698" ><table id="pid17698" class="plhin" summary="pid17698" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17698" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17698" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17698_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17698')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17698" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17698_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17698" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17698_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17698_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17698&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17698"   id="postnum17698" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>25</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17698" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17698">发表于 2019-6-27 17:11:14</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17698">
(* GBA的<font color="#ff0000">窗口</font>功能 ------------------------------ *)<br />
&nbsp; &nbsp;GBA的窗口很麻烦, 有三种窗口, 精灵窗口, &quot;镂空&quot;窗口, 标准窗口0, 1 (其中后两种实际是一种)...<br />
&nbsp; &nbsp;三种可以一起开, 优先级为先渲染 精灵窗口, 然后是标准窗口1, 最后标准窗口0 <br />
&nbsp; &nbsp;只要开了窗口功能, &quot;镂空&quot;窗口一定会存在, 并且通常的渲染都不可用, 请注意<br />
&nbsp; &nbsp;&quot;镂空&quot;窗口, 这个窗口会渲染在精灵窗口, 精灵窗口外区域的像素 ...<br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp;窗口有这么几个功能 1.裁剪, 标准窗口可以设置裁剪范围区域显示像素.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;2.复合使用BG, 每个窗口都能使用整个渲染的BG0~3和精灵输出层...<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;3.遮罩镂空效果<br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp;标准窗口就是通常意义上的裁剪窗口, 没啥好说的, <br />
&nbsp; &nbsp;精灵窗口有点意思, 会在当前窗口整个精灵输出层选择几个精灵来作为影子标记(编程人员可控的),本身不显示像素<br />
&nbsp; &nbsp;这部分精灵的非透明像素会设置影子标记, <br />
&nbsp; &nbsp;然后当前精灵窗口的BG, 精灵输出层的渲染, 只会在当前设置了影子标记的坐标画,渲染像素.<br />
&nbsp; &nbsp;<br />
(* GBA的BG优先级 ------------------------------ *)<br />
&nbsp; &nbsp;BG0~BG3 都可设置优先级<br />
&nbsp; &nbsp;优先级高的总是最后被画<br />
&nbsp; &nbsp;0优先级最高, 3最低.<br />
&nbsp; &nbsp;如果优先相同, 那么BG0优先级最大, BG1...BG2... BG3优先级最小...<br />
&nbsp; &nbsp;精灵也有优先级, <br />
&nbsp; &nbsp;比如精灵优先级为3, 那么他会画在也只能画在优先级为3的BG画布上, 画不到优先级为2的BG上. <br />
&nbsp; &nbsp;比如精灵优先级为1, 那么他能画在优先级3~1的画布上, 画不到优先级为0的画布上, 以此类推<br />
&nbsp; &nbsp;对于精灵优先级相同, 第一个精灵精灵0优先级最大, ....越往后优先级越小.<br />
&nbsp; &nbsp;<br />
(* GBA的简单像素<font color="#ff0000">滤波</font> ------------------------------ *)<br />
&nbsp; &nbsp;(像素滤波就三种种 -- Alpha混合和亮度调整,以及马赛克效果) <br />
&nbsp; &nbsp;Alpha混合 := 饱和相加 ( 每5位颜色分量*可编程分量系数A/16, 每5位颜色分量*可编程分量系数B/16)<br />
&nbsp; &nbsp;对于像素Alpha, 如果底下的像素是透明的, <br />
&nbsp; &nbsp;那么这个像素会以原始形态写入, 不进行Alpha处理 (这点很重要, 有的游戏不模拟此feature会明显画面异常)<br />
&nbsp; &nbsp;可编程分量系数 := 0~16 <br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp;亮度增加 := 饱和相加 ( (31-每5位颜色分量)*可编程分量系数/16, 每5位颜色分量)<br />
&nbsp; &nbsp;亮度减少 := 饱和 ( 每5位颜色分量*(16-可编程分量系数/16) )<br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp;(* ALPHA的具体细节 ------------------------------ *)<br />
&nbsp; &nbsp;&nbsp; &nbsp;Alpha混合需要两个BG层, 1st作为上层混合<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;2nd作为下层混合<br />
&nbsp; &nbsp;&nbsp; &nbsp;优先级也必须被适配.<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;这个应该能懂吧? GPU内部有个寄存器可以被设置选择哪些BG输出层作为 1st <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;哪些BG输出层作为 1nd <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;当然精灵输出层也可以被选择...<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;每一个 1st都能对应多个2nd BG卷轴Alpha混合, 反过来也是&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 举个例子: 1st : bg0, bg2, bg3 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;2nd : bg1 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; bg 渲染优先级:=&nbsp; &nbsp;bg1, bg0, bg2, bg3 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 先渲染bg1, 这个时候bg1被渲染完成, 底部是bg1的像素.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 然后渲染bg0, 刚好这个时候bg0被选中为1st 上层混合.底层是bg1,刚好2nd掩码中bg1也被选中了<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 进行混合, 此时bg0渲染完毕, 此时底部是bg0的像素, <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 开始渲染下一个BG, bg2, 再次进行Alpha测试, bg2被1st选中, 可惜底部的bg0没有被2nd选中, Alpha测试失败.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 此时底部是bg2的像素, 开始渲染bg3, 很失望, bg3也是测试失败, 不会进行Alpha混合.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Alpha多择&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;1st : bg0, bg2, bg3 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 2nd : bg1, bg2, bg3<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; bg 渲染优先级:=&nbsp; &nbsp;bg1, bg0, bg2, bg3 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 先渲染bg1, 这个时候bg1被渲染完成, 底部是bg1的像素.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 然后渲染bg0, 刚好这个时候bg0被选中为1st 上层混合.底层是bg1,刚好2nd掩码中bg1也被选中了<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 进行混合, 此时bg0渲染完毕, 此时底部是bg0的像素, <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 开始渲染下一个BG, bg2, 再次进行Alpha测试, bg2被1st选中, 底部的bg0也被2nd选中, Alpha测试成功,进行Alpha混合.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 此时底部是bg2的像素, 开始渲染bg3, 2nd:bg2, 1st:bg3也都被选中继续进行Alpha混合<br />
(* GBA的<font color="#ff0000">马赛克</font> ------------------------------ *)&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 马赛克很简单, 应该都会吧, 就是每隔几个像素插值一次.. 不多说了.<br />
(* GBA的屏幕渲染流程 ------------------------------ *)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; GBA在渲染开始的时候会先填充颜色, (backdrop)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 这个颜色就是BG_pal[0]的颜色,注意这部分颜色全是透明的<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 然后根据是否开启窗口, 开了就进行窗口渲染那一套逻辑渲染, <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 否则就是常规渲染</td></tr></table>


</div>
<div id="comment_17698" class="cm">
</div>

<div id="post_rate_div_17698"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17698"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17698&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17698&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17698').innerHTML ? $('review_support_17698').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17698"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17698&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17698').innerHTML ? $('review_against_17698').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17698"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17698" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17698', 'misc.php?mod=report&rtype=post&rid=17698&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17698_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17698')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17699" ><table id="pid17699" class="plhin" summary="pid17699" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17699" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17699" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17699_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17699')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17699" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17699_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17699" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17699_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17699_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17699&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17699"   id="postnum17699" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>26</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17699" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17699">发表于 2019-6-27 17:13:27</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17699">
<font color="Red">---------------------------------------------------------GPU IO映射---------------------------------------------------------------------</font></td></tr></table>


</div>
<div id="comment_17699" class="cm">
</div>

<div id="post_rate_div_17699"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17699"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17699&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17699&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17699').innerHTML ? $('review_support_17699').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17699"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17699&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17699').innerHTML ? $('review_against_17699').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17699"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17699" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17699', 'misc.php?mod=report&rtype=post&rid=17699&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17699_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17699')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17700" ><table id="pid17700" class="plhin" summary="pid17700" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17700" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17700" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17700_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17700')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17700" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17700_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17700" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17700_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17700_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17700&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17700"   id="postnum17700" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>27</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17700" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17700">发表于 2019-6-27 17:14:42</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17700">
(* GBA的GPU IO端口映射--此部分信息大多摘自GBATEK文档---------------------------- *)<br />
&nbsp;&nbsp;4000000h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;DISPCNT&nbsp; &nbsp;GPU主控<br />
&nbsp;&nbsp;4000002h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;-&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;颜色分量交换<br />
&nbsp;&nbsp;4000004h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;DISPSTAT&nbsp;&nbsp;GPU状态<br />
&nbsp;&nbsp;4000006h&nbsp;&nbsp;2&nbsp; &nbsp; R&nbsp; &nbsp; VCOUNT&nbsp; &nbsp; GPU线帧<br />
&nbsp;&nbsp;4000008h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;BG0CNT&nbsp; &nbsp; BG0 分控<br />
&nbsp;&nbsp;400000Ah&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;BG1CNT&nbsp; &nbsp; BG1 分控<br />
&nbsp;&nbsp;400000Ch&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;BG2CNT&nbsp; &nbsp; BG2 分控<br />
&nbsp;&nbsp;400000Eh&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;BG3CNT&nbsp; &nbsp; BG3 分控<br />
&nbsp;&nbsp;4000010h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG0HOFS&nbsp; &nbsp;BG0 X-滚动起点<br />
&nbsp;&nbsp;4000012h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG0VOFS&nbsp; &nbsp;BG0 Y-滚动起点<br />
&nbsp;&nbsp;4000014h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG1HOFS&nbsp; &nbsp;BG1 X-滚动起点<br />
&nbsp;&nbsp;4000016h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG1VOFS&nbsp; &nbsp;BG1 Y-滚动起点<br />
&nbsp;&nbsp;4000018h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG2HOFS&nbsp; &nbsp;BG2 X-滚动起点<br />
&nbsp;&nbsp;400001Ah&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG2VOFS&nbsp; &nbsp;BG2 Y-滚动起点<br />
&nbsp;&nbsp;400001Ch&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG3HOFS&nbsp; &nbsp;BG3 X-滚动起点<br />
&nbsp;&nbsp;400001Eh&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG3VOFS&nbsp; &nbsp;BG3 Y-滚动起点<br />
&nbsp;&nbsp;4000020h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG2PA&nbsp; &nbsp;&nbsp;&nbsp;BG2 仿射参数PA (dx)<br />
&nbsp;&nbsp;4000022h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG2PB&nbsp; &nbsp;&nbsp;&nbsp;BG2 仿射参数PB (dmx)<br />
&nbsp;&nbsp;4000024h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG2PC&nbsp; &nbsp;&nbsp;&nbsp;BG2 仿射参数PC (dy)<br />
&nbsp;&nbsp;4000026h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG2PD&nbsp; &nbsp;&nbsp;&nbsp;BG2 仿射参数PD (dmy)<br />
&nbsp;&nbsp;4000028h&nbsp;&nbsp;4&nbsp; &nbsp; W&nbsp; &nbsp; BG2X&nbsp; &nbsp;&nbsp; &nbsp;BG2 仿射引用点X (ref_x)<br />
&nbsp;&nbsp;400002Ch&nbsp;&nbsp;4&nbsp; &nbsp; W&nbsp; &nbsp; BG2Y&nbsp; &nbsp;&nbsp; &nbsp;BG2 仿射引用点Y (ref_y)<br />
&nbsp;&nbsp;4000030h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG3PA&nbsp; &nbsp;&nbsp;&nbsp;BG3 仿射参数PA (dx)<br />
&nbsp;&nbsp;4000032h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG3PB&nbsp; &nbsp;&nbsp;&nbsp;BG3 仿射参数PB (dmx)<br />
&nbsp;&nbsp;4000034h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG3PC&nbsp; &nbsp;&nbsp;&nbsp;BG3 仿射参数PC (dy)<br />
&nbsp;&nbsp;4000036h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG3PD&nbsp; &nbsp;&nbsp;&nbsp;BG3 仿射参数PD (dmy)<br />
&nbsp;&nbsp;4000038h&nbsp;&nbsp;4&nbsp; &nbsp; W&nbsp; &nbsp; BG3X&nbsp; &nbsp;&nbsp; &nbsp;BG3 仿射引用点X (ref_x)<br />
&nbsp;&nbsp;400003Ch&nbsp;&nbsp;4&nbsp; &nbsp; W&nbsp; &nbsp; BG3Y&nbsp; &nbsp;&nbsp; &nbsp;BG3 仿射引用点Y (ref_y)<br />
&nbsp;&nbsp;4000040h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; WIN0H&nbsp; &nbsp;&nbsp;&nbsp;标准窗口 0 水平裁剪设置<br />
&nbsp;&nbsp;4000042h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; WIN1H&nbsp; &nbsp;&nbsp;&nbsp;标准窗口 1 水平裁剪设置<br />
&nbsp;&nbsp;4000044h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; WIN0V&nbsp; &nbsp;&nbsp;&nbsp;标准窗口 0 垂直裁剪设置<br />
&nbsp;&nbsp;4000046h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; WIN1V&nbsp; &nbsp;&nbsp;&nbsp;标准窗口 1 垂直裁剪设置<br />
&nbsp;&nbsp;4000048h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;WININ&nbsp; &nbsp;&nbsp;&nbsp;窗口win0, win1 BG选择设置<br />
&nbsp;&nbsp;400004Ah&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;WINOUT&nbsp; &nbsp; 精灵, 镂空窗口 BG选择设置<br />
&nbsp;&nbsp;400004Ch&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; MOSAIC&nbsp; &nbsp; 马萨克尺寸设置<br />
&nbsp;&nbsp;4000050h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;BLDCNT&nbsp; &nbsp; 像素滤波设置<br />
&nbsp;&nbsp;4000052h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;BLDALPHA&nbsp;&nbsp;Alpha混合使用的分量<br />
&nbsp;&nbsp;4000054h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BLDY&nbsp; &nbsp;&nbsp; &nbsp;亮度调整分量</td></tr></table>


</div>
<div id="comment_17700" class="cm">
</div>

<div id="post_rate_div_17700"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17700"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17700&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17700&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17700').innerHTML ? $('review_support_17700').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17700"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17700&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17700').innerHTML ? $('review_against_17700').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17700"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17700" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17700', 'misc.php?mod=report&rtype=post&rid=17700&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17700_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17700')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17701" ><table id="pid17701" class="plhin" summary="pid17701" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17701" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17701" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17701_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17701')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17701" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17701_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17701" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17701_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17701_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17701&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17701"   id="postnum17701" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>28</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17701" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17701">发表于 2019-6-27 17:17:52</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17701">
&nbsp;&nbsp;(* 4000000h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;DISPCNT&nbsp; &nbsp;GPU主控---- *)<br />
&nbsp;&nbsp;0-2&nbsp; &nbsp;图形模式&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; (6, 7是UB行为)<br />
&nbsp;&nbsp;3&nbsp; &nbsp;&nbsp;&nbsp;机器类型指示&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;(用来只是当前处于何种模式 0:= GBA, 1:GBC)<br />
&nbsp;&nbsp;4&nbsp; &nbsp;&nbsp;&nbsp;帧缓冲选择&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(帧缓冲选择, 适用于模式4, 模式5)<br />
&nbsp;&nbsp;5&nbsp; &nbsp;&nbsp;&nbsp;HBlank时序自由访问显存致能&nbsp;&nbsp;(1=可以)<br />
&nbsp;&nbsp;6&nbsp; &nbsp;&nbsp;&nbsp;OAM-TILE寻址方式 (0=精灵OAM-Tile寻址使用固定步长32, 1=精灵OAM-Tile寻址使用自身连续步长)<br />
&nbsp;&nbsp;7&nbsp; &nbsp;&nbsp;&nbsp;强制变白&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(无论何时都能访问显存, 当前渲染线直接变白)<br />
&nbsp;&nbsp;8&nbsp; &nbsp;&nbsp;&nbsp;BG0显示开关&nbsp;&nbsp;(0=关, 1=开)<br />
&nbsp;&nbsp;9&nbsp; &nbsp;&nbsp;&nbsp;BG1显示开关&nbsp;&nbsp;(0=关, 1=开)<br />
&nbsp;&nbsp;10&nbsp; &nbsp; BG2显示开关&nbsp;&nbsp;(0=关, 1=开)<br />
&nbsp;&nbsp;11&nbsp; &nbsp; BG3显示开关&nbsp;&nbsp;(0=关, 1=开)<br />
&nbsp;&nbsp;12&nbsp; &nbsp; 精灵输出层显示开关&nbsp;&nbsp;(0=关, 1=开)<br />
&nbsp;&nbsp;13&nbsp; &nbsp; 标准窗口0 启用开关&nbsp; &nbsp;(0=关, 1=开)<br />
&nbsp;&nbsp;14&nbsp; &nbsp; 标准窗口1 启用开关&nbsp; &nbsp;(0=关, 1=开)<br />
&nbsp;&nbsp;15&nbsp; &nbsp; 精灵窗口 启用开关&nbsp; &nbsp;(0=关, 1=开)<br />
 <br />
&nbsp;&nbsp;(* 4000002h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;-&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;颜色分量交换---- *)<br />
&nbsp;&nbsp;输出交换 rgb分量的b位和r位, 通常情况不使用, 好像适用于外部设备?不太清楚.<br />
&nbsp;&nbsp;基本没几个模拟器会管这个东西,.<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;(* 4000004h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;DISPSTAT&nbsp;&nbsp;GPU状态&nbsp;&nbsp;---- *)<br />
&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp;&nbsp;V-BLANK标志&nbsp; &nbsp;(只读) (1=VBlank) (此标志会在渲染线160.226的时候被设置)<br />
&nbsp;&nbsp;1&nbsp; &nbsp;&nbsp;&nbsp;H-Blank标志&nbsp; &nbsp;(只读) (1=HBlank) (每条扫描线的HBlank阶段都会被设置)<br />
&nbsp;&nbsp;2&nbsp; &nbsp;&nbsp;&nbsp;线帧扫描匹配测试标志 (只读) (1=Match)&nbsp;&nbsp;(当前扫描线被匹配会设置, 否则清除)&nbsp; &nbsp; <br />
&nbsp;&nbsp;3&nbsp; &nbsp;&nbsp;&nbsp;V-BLANK 发生IRQ 中断致能 (可读写)<br />
&nbsp;&nbsp;4&nbsp; &nbsp;&nbsp;&nbsp;H-Blank 发生IRQ 中断致能 (可读写)<br />
&nbsp;&nbsp;5&nbsp; &nbsp;&nbsp;&nbsp;线帧扫描匹配测试成功 中断致能&nbsp; &nbsp;&nbsp; &nbsp; (可读写)<br />
&nbsp;&nbsp;6&nbsp; &nbsp;&nbsp;&nbsp;不使用<br />
&nbsp;&nbsp;7&nbsp; &nbsp;&nbsp;&nbsp;不使用<br />
&nbsp;&nbsp;8-15&nbsp;&nbsp;线帧扫描匹配设置行&nbsp; &nbsp;&nbsp; &nbsp;(可设置0.227)&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; (可读写)<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;GPU一帧要扫描228根扫描线, <br />
&nbsp; &nbsp;&nbsp; &nbsp;扫完扫描线会回滚到0的地方继续回扫,继续新的一帧<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;CPU的频率是,&nbsp;&nbsp;16.78MHz<br />
&nbsp; &nbsp;&nbsp; &nbsp;LCD一秒刷新 59.727次, <br />
&nbsp; &nbsp;&nbsp; &nbsp;很容易得出刷新一帧数需要的CPU 时钟周期:= 16780000/59.727 := 280944.96626316<br />
&nbsp; &nbsp;&nbsp; &nbsp;分给228条扫描线:= 280944.96626316/228 := 1232.2147643121, <br />
&nbsp; &nbsp;&nbsp; &nbsp;也就是每条扫描线可跑这么时钟周期的CPU指令数,<br />
&nbsp; &nbsp;&nbsp; &nbsp;其中前960个Ticks是正常扫描线渲染周期, 剩下的就是HBlank渲染周期.<br />
&nbsp; &nbsp;&nbsp; &nbsp;HBlank实质是电子枪回扫至下一行起点的过程, <br />
&nbsp; &nbsp;&nbsp; &nbsp;VBlank是电子枪回扫至光栅器原点的过程.<br />
&nbsp; &nbsp;&nbsp; &nbsp;前160扫描线全是可视扫描线, 后面的几十条, 实际上是不会进行实际操作的, <br />
&nbsp; &nbsp;&nbsp; &nbsp;就是电子枪回扫至原点的VBlank过程, 这个时候访问显存资源是最安全的.<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;GPU内部有一个线帧扫描计数器, 会记录当前扫描线的行数.<br />
&nbsp; &nbsp;&nbsp; &nbsp;这个线帧扫描计数器在每次HBlank周期都会更新, <br />
&nbsp; &nbsp;&nbsp; &nbsp;然后匹配测试当前设置的线帧扫描匹配设置行, 如果匹配也会设置 线帧扫描匹配测试标志<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;HBlank-VBlank阶段, 线帧扫描测试成功都可设置是否触发IRQ中断, <br />
&nbsp; &nbsp;&nbsp; &nbsp;注意啊, 这个触发IRQ中断, 只是设置GBA设备的IF位.仅此而已<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000006h&nbsp;&nbsp;2&nbsp; &nbsp; R&nbsp; &nbsp; VCOUNT&nbsp; &nbsp; GPU线帧&nbsp;&nbsp;---- *)&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;0-7 指示当前扫描线, 其余位不用, 这个扫描线计数器在每条扫描线的H-Blank阶段会更新.<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000008h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;BG0CNT&nbsp; &nbsp; BG0 分控&nbsp;&nbsp;---- *)&nbsp; &nbsp; <br />
&nbsp;&nbsp;(* 400000Ah&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;BG1CNT&nbsp; &nbsp; BG1 分控&nbsp;&nbsp;---- *)&nbsp; &nbsp; <br />
&nbsp;&nbsp;(* 400000Ch&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;BG2CNT&nbsp; &nbsp; BG2 分控&nbsp;&nbsp;---- *)&nbsp; &nbsp; <br />
&nbsp;&nbsp;(* 400000Eh&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;BG3CNT&nbsp; &nbsp; BG3 分控&nbsp;&nbsp;---- *)&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp; &nbsp;0-1&nbsp; &nbsp;BG优先级设置, 2位范围0~3 <br />
&nbsp; &nbsp;&nbsp; &nbsp;2-3&nbsp; &nbsp;字符表基地址, 2位范围0~3, 每个单元16K, 从显存0x6000000开始的<br />
&nbsp; &nbsp;&nbsp; &nbsp;4-5&nbsp; &nbsp;不使用.<br />
&nbsp; &nbsp;&nbsp; &nbsp;6&nbsp; &nbsp;&nbsp;&nbsp;当前马赛克致能&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1?允许:不允许<br />
&nbsp; &nbsp;&nbsp; &nbsp;7&nbsp; &nbsp;&nbsp;&nbsp;颜色模式&nbsp; &nbsp;&nbsp; &nbsp; (0=4位调色板Bank+Tile4位, 1=256位调色板)<br />
&nbsp; &nbsp;&nbsp; &nbsp;8-12&nbsp;&nbsp;命名表基地址&nbsp; &nbsp;&nbsp;&nbsp;(0-31, 每个单元2KB, 从显存0x6000000开始的)<br />
&nbsp; &nbsp;&nbsp; &nbsp;13&nbsp; &nbsp; BG2/BG3: 仿射坐标溢出屏幕处理 (0=透明,不显示, 1=回滚)<br />
&nbsp; &nbsp;&nbsp; &nbsp;14-15 命名表视频缓冲尺寸 (0-3)<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;Value&nbsp;&nbsp;标准模式&nbsp; &nbsp;&nbsp; &nbsp;旋转模式<br />
&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;256x256 (2K)&nbsp; &nbsp;128x128&nbsp; &nbsp;(256 bytes)<br />
&nbsp; &nbsp;&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;512x256 (4K)&nbsp; &nbsp;256x256&nbsp; &nbsp;(1K)<br />
&nbsp; &nbsp;&nbsp; &nbsp;2&nbsp; &nbsp;&nbsp; &nbsp;256x512 (4K)&nbsp; &nbsp;512x512&nbsp; &nbsp;(4K)<br />
&nbsp; &nbsp;&nbsp; &nbsp;3&nbsp; &nbsp;&nbsp; &nbsp;512x512 (8K)&nbsp; &nbsp;1024x1024 (16K)<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;(* 4000010h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG0HOFS&nbsp; &nbsp;BG0 X-滚动起点&nbsp;&nbsp;---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000012h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG0VOFS&nbsp; &nbsp;BG0 Y-滚动起点&nbsp;&nbsp;---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000014h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG1HOFS&nbsp; &nbsp;BG1 X-滚动起点&nbsp;&nbsp;---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000016h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG1VOFS&nbsp; &nbsp;BG1 Y-滚动起点&nbsp;&nbsp;---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000018h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG2HOFS&nbsp; &nbsp;BG2 X-滚动起点&nbsp;&nbsp;---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 400001Ah&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG2VOFS&nbsp; &nbsp;BG2 Y-滚动起点&nbsp;&nbsp;---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 400001Ch&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG3HOFS&nbsp; &nbsp;BG3 X-滚动起点&nbsp;&nbsp;---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 400001Eh&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG3VOFS&nbsp; &nbsp;BG3 Y-滚动起点&nbsp;&nbsp;---- *)&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;前9位可用, 范围0~511<br />
&nbsp; &nbsp;&nbsp; &nbsp;每个BG渲染器各自的标准滚动设置, 注意如果是仿射旋转BG, 会忽略此参数使用仿射参数.<br />
&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000020h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG2PA&nbsp; &nbsp;&nbsp;&nbsp;BG2 仿射参数PA (dx) ---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000022h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG2PB&nbsp; &nbsp;&nbsp;&nbsp;BG2 仿射参数PB (dmx) ---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000024h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG2PC&nbsp; &nbsp;&nbsp;&nbsp;BG2 仿射参数PC (dy) ---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000026h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG2PD&nbsp; &nbsp;&nbsp;&nbsp;BG2 仿射参数PD (dmy) ---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000028h&nbsp;&nbsp;4&nbsp; &nbsp; W&nbsp; &nbsp; BG2X&nbsp; &nbsp;&nbsp; &nbsp;BG2 仿射引用点X (ref_x) ---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 400002Ch&nbsp;&nbsp;4&nbsp; &nbsp; W&nbsp; &nbsp; BG2Y&nbsp; &nbsp;&nbsp; &nbsp;BG2 仿射引用点Y (ref_y) ---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000030h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG3PA&nbsp; &nbsp;&nbsp;&nbsp;BG3 仿射参数PA (dx) ---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000032h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG3PB&nbsp; &nbsp;&nbsp;&nbsp;BG3 仿射参数PB (dmx) ---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000034h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG3PC&nbsp; &nbsp;&nbsp;&nbsp;BG3 仿射参数PC (dy) ---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000036h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BG3PD&nbsp; &nbsp;&nbsp;&nbsp;BG3 仿射参数PD (dmy) ---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 4000038h&nbsp;&nbsp;4&nbsp; &nbsp; W&nbsp; &nbsp; BG3X&nbsp; &nbsp;&nbsp; &nbsp;BG3 仿射引用点X (ref_x) ---- *)&nbsp; &nbsp;<br />
&nbsp;&nbsp;(* 400003Ch&nbsp;&nbsp;4&nbsp; &nbsp; W&nbsp; &nbsp; BG3Y&nbsp; &nbsp;&nbsp; &nbsp;BG3 仿射引用点Y (ref_y) ---- *)&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp; 仿射BG那段讲了, 这里不再赘述.多余的位也不会使用啦,<br />
&nbsp; &nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;(* 4000040h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; WIN0H&nbsp; &nbsp;&nbsp;&nbsp;标准窗口 0 水平裁剪设置 ---- *) <br />
&nbsp;&nbsp;(* 4000042h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; WIN1H&nbsp; &nbsp;&nbsp;&nbsp;标准窗口 1 水平裁剪设置 ---- *) <br />
&nbsp;&nbsp;(* 4000044h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; WIN0V&nbsp; &nbsp;&nbsp;&nbsp;标准窗口 0 垂直裁剪设置 ---- *) <br />
&nbsp;&nbsp;(* 4000046h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; WIN1V&nbsp; &nbsp;&nbsp;&nbsp;标准窗口 1 垂直裁剪设置 ---- *) <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;每个Word的低位都是 Right/bottom,高位则是Left/top<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;水平方向如果left&gt;right或者right &gt;240都会被解释成right:= 240 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;垂直方向如果top&gt;bottom或者bottom &gt;160都会被解释成bottom:= 160&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;注意设置的right/bottom的值, 实际上只会渲染到 POS-1的地方 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;比如left := 0 right := 240, 那么只会渲染POS 0 ~239<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;(* 4000048h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;WININ&nbsp; &nbsp;&nbsp;&nbsp;窗口win0, win1 BG选择设置 ---- *) <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0-3&nbsp; &nbsp;标准窗口 0 BG0-BG3 选择显示位域 1:显示<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;4&nbsp; &nbsp;&nbsp;&nbsp;精灵输出层 1:显示<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5&nbsp; &nbsp;&nbsp;&nbsp;标准窗口0 像素滤波启用 0:不启用 比如Alpha混合/亮度调整不会发生, 不影响马赛克<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;8-11&nbsp; &nbsp;标准窗口 1 BG0-BG3 选择显示位域 1:显示<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;12&nbsp; &nbsp;&nbsp;&nbsp;精灵输出层 1:显示<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;13&nbsp; &nbsp;&nbsp;&nbsp;标准窗口1 像素滤波启用 0:不启用<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;其余位域不使用<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;(* 400004Ah&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;WINOUT&nbsp; &nbsp; 精灵, 镂空窗口 BG选择设置 ---- *) <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0-3&nbsp; &nbsp;镂空窗口 BG0-BG3 选择显示位域 1:显示<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;4&nbsp; &nbsp;&nbsp;&nbsp;镂空窗口精灵输出层 1:显示<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5&nbsp; &nbsp;&nbsp;&nbsp;镂空窗口 像素滤波启用 0:不启用<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;8-11&nbsp; &nbsp;精灵窗口 BG0-BG3 选择显示位域 1:显示<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;12&nbsp; &nbsp;&nbsp;&nbsp;精灵窗口精灵输出层 1:显示<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;13&nbsp; &nbsp;&nbsp;&nbsp;精灵窗口 像素滤波启用 0:不启用&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;其余位域不使用<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;(* 400004Ch&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; MOSAIC&nbsp; &nbsp; 马萨克尺寸设置 ---- *) <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0-3&nbsp; &nbsp;BG 马赛克水平映射&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;4-7&nbsp; &nbsp;BG 马赛克垂直映射 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;8-11&nbsp;&nbsp;OBJ 马赛克水平映射 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;12-15 OBJ 马赛克垂直映射 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;当参数被设置为0的时候当前的类型,向量的马赛克滤波将不会发生.<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;举个例子:当马赛克水平映射设置成7<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;那么每隔7+1个像素就会插值取得一个当前block整数处的像素来填充block余数处的像素, 每次到达block整数处更新一次这个值 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;比如 POS 0.(7+1) . 无余数, block整数处, 取 POS (0)的像素. <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; POS 1.(7+1) . 1 余数, 填充 POS (0)的像素 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; .<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; POS 8.(7+1) . 0无余数, block整数处, 取 POS (8)的像素. <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; .<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 以此类推 </td></tr></table>


</div>
<div id="comment_17701" class="cm">
</div>

<div id="post_rate_div_17701"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17701"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17701&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17701&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17701').innerHTML ? $('review_support_17701').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17701"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17701&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17701').innerHTML ? $('review_against_17701').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17701"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17701" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17701', 'misc.php?mod=report&rtype=post&rid=17701&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17701_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17701')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17702" ><table id="pid17702" class="plhin" summary="pid17702" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17702" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17702" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17702_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17702')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17702" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17702_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17702" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17702_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17702_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17702&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17702"   id="postnum17702" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>29</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17702" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17702">发表于 2019-6-27 17:18:11</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17702">
<i class="pstatus"> 本帖最后由 moecmks 于 2019-6-27 17:19 编辑 </i><br />
<br />
&nbsp;&nbsp;(* 4000050h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;BLDCNT&nbsp; &nbsp; 像素滤波设置&nbsp; &nbsp;&nbsp;&nbsp;---- *) <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(* 1st选择, 这个对于非Alpha, 也表示选择该层---*)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0&nbsp; &nbsp;&nbsp;&nbsp;BG0 1st<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;1&nbsp; &nbsp;&nbsp;&nbsp;BG1 1st <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;2&nbsp; &nbsp;&nbsp;&nbsp;BG2 1st <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;3&nbsp; &nbsp;&nbsp;&nbsp;BG3 1st<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;4&nbsp; &nbsp;&nbsp;&nbsp;OBJ 1st<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;5&nbsp; &nbsp;&nbsp;&nbsp;BD&nbsp;&nbsp;1st <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;6-7&nbsp; &nbsp;像素滤波选择 (0-3, see below)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0 = 无像素滤波 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;1 = Alphe混合<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;2 = 亮度调整-变白<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;3 = 亮度调整-变暗<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp; (* 2nd选择, 这个对于非Alpha混合是不使用的---*)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;8&nbsp; &nbsp;&nbsp;&nbsp;BG0 2nd <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;9&nbsp; &nbsp;&nbsp;&nbsp;BG1 2nd<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;10&nbsp; &nbsp; BG2 2nd <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;11&nbsp; &nbsp; BG3 2nd <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;12&nbsp; &nbsp; OBJ 2nd <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;13&nbsp; &nbsp; BD&nbsp;&nbsp;2nd <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;其余位不使用<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;(* 4000052h&nbsp;&nbsp;2&nbsp; &nbsp; R/W&nbsp;&nbsp;BLDALPHA&nbsp;&nbsp;Alpha混合使用的分量&nbsp; &nbsp;&nbsp;&nbsp;---- *)&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0-4&nbsp; &nbsp;1st Alpha分量 (1st Target) (0.16 = 0/16.16/16, 17.31=16/16)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;8-12&nbsp;&nbsp;2nd Alpha分量 (2nd Target) (0.16 = 0/16.16/16, 17.31=16/16)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;其余位不使用<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;(* 4000054h&nbsp;&nbsp;2&nbsp; &nbsp; W&nbsp; &nbsp; BLDY&nbsp; &nbsp;&nbsp; &nbsp;亮度调整分量&nbsp; &nbsp;&nbsp;&nbsp;---- *)&nbsp; &nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;前四位有用, 跟Alpha一样的设置, 0~31, 大于16则是16<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
(* 精灵OAM所使用的结构 ---- *)<br />
&nbsp; &nbsp;OAM只有1K字节, 有128只精灵 <br />
&nbsp; &nbsp;所以这么一算, 1024/128 := 8个字节<br />
&nbsp; &nbsp;每个精灵的属性是按照uint16_t 的尺寸安排的,<br />
&nbsp; &nbsp;也就是每个精灵有四个单元的 attr字,<br />
&nbsp; &nbsp;其中最后一个字是用来凑成仿射参数, 后面在讲, 先解释前三个属性字.<br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp; (* attr0 -*)<br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp; 0-7&nbsp; &nbsp;精灵的Y坐标&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(0-255, 注意超过255会回滚到0显示)<br />
&nbsp; &nbsp; 8&nbsp; &nbsp;&nbsp;&nbsp;仿射精灵致能&nbsp;&nbsp;(1:启用 0:标准精灵渲染)<br />
&nbsp; &nbsp;&nbsp;&nbsp;启用仿射精灵那么d9就是双倍精灵致能 (1:启用)<br />
&nbsp; &nbsp;&nbsp;&nbsp;标准渲染d9则是渲染致能 (1:不渲染此精灵 0:渲染) <br />
&nbsp; &nbsp; 10-11 OBJ Mode&nbsp;&nbsp;(0=标准渲染, 1=Alpha混合, 2=精灵窗口阴影标志精灵, 3=UB值)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;如果此处设置Alpha混合, 将会忽略BLDCNT的像素滤波类型参数, 强制启用Alpha混合 <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp; &nbsp; 12&nbsp; &nbsp; OBJ 马赛克&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; 1:启用<br />
&nbsp; &nbsp; 13&nbsp; &nbsp; 8位/4位指示&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(0=4位+调色板Bank 1=256位调色板)<br />
&nbsp; &nbsp; 14-15 OBJ Shape&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(0=Square,1=Horizontal,2=Vertical,3=Prohibited)<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; (* attr1 -*)<br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp; 0-8&nbsp; &nbsp;X-Coordinate&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;(0-511, 注意超过511会回滚到0显示)<br />
&nbsp; &nbsp; 启用仿射精灵:<br />
&nbsp; &nbsp;&nbsp; &nbsp;9-13&nbsp;&nbsp;仿射参数选择 (0-31)<br />
&nbsp; &nbsp; 标准渲染:<br />
&nbsp; &nbsp;&nbsp; &nbsp;9-11&nbsp;&nbsp;不使用<br />
&nbsp; &nbsp;&nbsp; &nbsp;12&nbsp; &nbsp; 水平翻转&nbsp; &nbsp;&nbsp; &nbsp;(0=Normal, 1=翻转)<br />
&nbsp; &nbsp;&nbsp; &nbsp;13&nbsp; &nbsp; 垂直反转&nbsp; &nbsp;&nbsp; &nbsp;(0=Normal, 1=翻转)<br />
&nbsp; &nbsp; 14-15 精灵尺寸 (配合attr0的d14-d15可确认精灵的尺寸) <br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp;&nbsp;&nbsp;尺寸&nbsp;&nbsp;Square&nbsp; &nbsp;Horizontal&nbsp;&nbsp;Vertical<br />
&nbsp; &nbsp;&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp;&nbsp;8x8&nbsp; &nbsp;&nbsp; &nbsp;16x8&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;8x16<br />
&nbsp; &nbsp;&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp;&nbsp;16x16&nbsp; &nbsp; 32x8&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;8x32<br />
&nbsp; &nbsp;&nbsp; &nbsp;2&nbsp; &nbsp;&nbsp;&nbsp;32x32&nbsp; &nbsp; 32x16&nbsp; &nbsp;&nbsp; &nbsp; 16x32<br />
&nbsp; &nbsp;&nbsp; &nbsp;3&nbsp; &nbsp;&nbsp;&nbsp;64x64&nbsp; &nbsp; 64x32&nbsp; &nbsp;&nbsp; &nbsp; 32x64<br />
<br />
&nbsp; &nbsp; (* attr2 -*)<br />
<br />
&nbsp; &nbsp; 0-9&nbsp; &nbsp;Tile ID<br />
&nbsp; &nbsp; 10-11 精灵优先级<br />
&nbsp; &nbsp; 12-15 调色板Bank, 适用于4位Tile渲染.<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; (* 精灵的仿射参数dx, dmx, dy, dmy 选择 ---*)<br />
&nbsp; &nbsp; attr1的d9-d13 可选择0~31的仿射bank<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; 每一个bank开始的第1个OAM的attr3就是dx <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;第2个OAM的attr3就是dmx <br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;第3个OAM的attr3就是dy<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;第4个OAM的attr3就是dmy <br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; 每四个完整的OAM属性字节结构块(也就是32个字节一个Bank) 是一个完整的Bank&nbsp;&nbsp;<br />
</td></tr></table>


</div>
<div id="comment_17702" class="cm">
</div>

<div id="post_rate_div_17702"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17702"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17702&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17702&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17702').innerHTML ? $('review_support_17702').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17702"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17702&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17702').innerHTML ? $('review_against_17702').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17702"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17702" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17702', 'misc.php?mod=report&rtype=post&rid=17702&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17702_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17702')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
</div><div id="post_17703" ><table id="pid17703" class="plhin" summary="pid17703" cellspacing="0" cellpadding="0">
<tr>
 <td class="pls" rowspan="2">
<div id="favatar17703" class="pls favatar">
<div class="pi">
<div class="authi"><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xw1">moecmks</a>
</div>
</div>
<div class="p_pop blk bui card_gender_1" id="userinfo17703" style="display: none; margin-top: -11px;">
<div class="m z">
<div id="userinfo17703_ma"></div>
</div>
<div class="i y">
<div>
<strong><a href="http://cpp.ra2diy.com/space-uid-24.html" target="_blank" class="xi2">moecmks</a></strong>
<em>当前离线</em>
</div><dl class="cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl><div class="imicn">
<a href="http://" target="_blank" title="查看个人网站"><img src="https://cpp.ra2diy.com/static/image/common/forumlink.gif" alt="查看个人网站" /></a><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" target="_blank" title="查看详细资料"><img src="https://cpp.ra2diy.com/static/image/common/userinfo.gif" alt="查看详细资料" /></a>
</div>
<div id="avatarfeed"><span id="threadsortswait"></span></div>
</div>
</div>
<div>
<div class="avatar" onmouseover="showauthor(this, 'userinfo17703')"><a href="http://cpp.ra2diy.com/space-uid-24.html" class="avtm" target="_blank"><img src="http://cpp.ra2diy.com/uc_server/avatar.php?uid=24&size=middle" /></a></div>
</div>
<div class="tns xg2"><table cellspacing="0" cellpadding="0"><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=thread&view=me&from=space" class="xi2">4</a></p>主题</th><th><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=thread&type=reply&view=me&from=space" class="xi2">104</a></p>帖子</th><td><p><a href="http://cpp.ra2diy.com/home.php?mod=space&uid=24&do=profile" class="xi2">353</a></p>积分</td></table></div>

<p><em><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=usergroup&gid=12" target="_blank">中级会员</a></em></p>


<p><span id="g_up17703" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!'});"><img src="https://cpp.ra2diy.com/static/image/common/star_level2.gif" alt="Rank: 3" /><img src="https://cpp.ra2diy.com/static/image/common/star_level1.gif" alt="Rank: 3" /></span></p>
<div id="g_up17703_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>


<p><span class="pbg2"  id="upgradeprogress_17703" onmouseover="showMenu({'ctrlid':this.id, 'pos':'12!', 'menuid':'g_up17703_menu'});"><span class="pbr2" style="width:51%;"></span></span></p>
<div id="g_up17703_menu" class="tip tip_4" style="display: none;"><div class="tip_horn"></div><div class="tip_c">中级会员, 积分 353, 距离下一级还需 147 积分</div></div>

<dl class="pil cl">
  <dt>威望</dt><dd>9 </dd>
  <dt>经验</dt><dd>222 </dd>
  <dt>贡献</dt><dd>9 </dd>
</dl>

<dl class="pil cl"></dl><ul class="xl xl2 o cl">
<li class="pm2"><a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=pm&op=showmsg&handlekey=showmsg_24&touid=24&pmid=0&daterange=2&pid=17703&tid=17333" onclick="showWindow('sendpm', this.href);" title="发消息" class="xi2">发消息</a></li>
</ul>
</div>
</td>
<td class="plc">
<div class="pi">
<strong>
<a href="http://cpp.ra2diy.com/forum.php?mod=redirect&goto=findpost&ptid=17333&pid=17703"   id="postnum17703" onclick="setCopy(this.href, '帖子地址复制成功');return false;">
<em>30</em><sup>#</sup></a>
</strong>
<div class="pti">
<div class="pdbt">
</div>
<div class="authi">
<img class="authicn vm" id="authicon17703" src="https://cpp.ra2diy.com/static/image/common/ico_lz.png" />
&nbsp;楼主<span class="pipe">|</span>
<em id="authorposton17703">发表于 2019-6-27 17:39:04</em>
<span class="pipe">|</span>
<a href="http://cpp.ra2diy.com/forum.php?mod=viewthread&tid=17333&page=1&authorid=24" rel="nofollow">只看该作者</a>
</div>
</div>
</div><div class="pct"><div class="pcb">
<div class="t_fsz">
<table cellspacing="0" cellpadding="0"><tr><td class="t_f" id="postmessage_17703">
<i class="pstatus"> 本帖最后由 moecmks 于 2019-6-27 17:47 编辑 </i><br />
<br />
GPU实现代码 <a href="https://pastebin.com/hdsvs1hT" target="_blank">https://pastebin.com/hdsvs1hT</a>附渲染效果图,<br />
 <img id="aimg_DrqRj" onclick="zoom(this, this.src, 0, 0, 0)" class="zoom" src="https://s2.ax1x.com/2019/06/27/ZuC5TO.png" onmouseover="img_onmouseoverfunc(this)" onload="thumbImg(this)" border="0" alt="" /><br />
<img id="aimg_OUJ5m" onclick="zoom(this, this.src, 0, 0, 0)" class="zoom" width="600" height="320" src="https://s2.ax1x.com/2019/06/27/ZuPmAU.png" onmouseover="img_onmouseoverfunc(this)" onclick="zoom(this)" style="cursor:pointer" border="0" alt="" /><br />
至此，GPU 大致讲解完毕<br />
<br />
</td></tr></table>


</div>
<div id="comment_17703" class="cm">
</div>

<div id="post_rate_div_17703"></div>
</div>
</div>

</td></tr>
<tr><td class="plc plm">
<div class="sign" style="max-height:100px;maxHeightIE:100px;">LGD是TI8冠军！-2018.8.24 16:30留</div>
</td>
</tr>
<tr id="_postposition17703"></tr>
<tr>
<td class="pls"></td>
<td class="plc" style="overflow:visible;">
<div class="po hin">
<div class="pob cl">
<em>
<a class="fastre" href="https://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&repquote=17703&extra=page=1&page=1" onclick="showWindow('reply', this.href)">回复</a>
<a class="replyadd" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=support&tid=17333&pid=17703&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_support_17703').innerHTML ? $('review_support_17703').innerHTML : 0) + ' 人 支持'">支持 <span id="review_support_17703"></span></a>
<a class="replysubtract" href="https://cpp.ra2diy.com/forum.php?mod=misc&action=postreview&do=against&tid=17333&pid=17703&hash=babe254c"  onclick="showWindow('login', this.href)" onmouseover="this.title = ($('review_against_17703').innerHTML ? $('review_against_17703').innerHTML : 0) + ' 人 反对'">反对 <span id="review_against_17703"></span></a>
</em>

<p>
<a href="javascript:;" id="mgc_post_17703" onmouseover="showMenu(this.id)" class="showmenu">使用道具</a>
<a href="javascript:;" onclick="showWindow('miscreport17703', 'misc.php?mod=report&rtype=post&rid=17703&tid=17333&fid=49', 'get', -1);return false;">举报</a>
</p>

<ul id="mgc_post_17703_menu" class="p_pop mgcmn" style="display: none;">
</ul>
<script type="text/javascript" reload="1">checkmgcmn('post_17703')</script>
</div>
</div>
</td>
</tr>
<tr class="ad">
<td class="pls">
</td>
<td class="plc">
</td>
</tr>
</table>
<script type="text/javascript" reload="1">
aimgcount[17703] = ['DrqRj','OUJ5m'];
attachimggroup(17703);
attachimgshow(17703);
var aimgfid = 0;
</script>
</div><div id="postlistreply" class="pl"><div id="post_new" class="viewthread_table" style="display: none"></div></div>
</div>


<form method="post" autocomplete="off" name="modactions" id="modactions">
<input type="hidden" name="formhash" value="babe254c" />
<input type="hidden" name="optgroup" />
<input type="hidden" name="operation" />
<input type="hidden" name="listextra" value="page%3D1" />
<input type="hidden" name="page" value="1" />
</form>


<div class="pgbtn"><a href="http://cpp.ra2diy.com/thread-17333-2-1.html" hidefocus="true" class="bm_h">下一页 &raquo;</a></div>

<div class="pgs mtm mbm cl">
<div class="pg"><strong>1</strong><a href="http://cpp.ra2diy.com/thread-17333-2-1.html">2</a><label><input type="text" name="custompage" class="px" size="2" title="输入页码，按回车快速跳转" value="1" onkeydown="if(event.keyCode==13) {window.location='forum.php?mod=viewthread&tid=17333&amp;extra=page%3D1&amp;page='+this.value;; doane(event);}" /><span title="共 2 页"> / 2 页</span></label><a href="http://cpp.ra2diy.com/thread-17333-2-1.html" class="nxt">下一页</a></div><span class="pgb y" id="visitedforumstmp" onmouseover="$('visitedforums').id = 'visitedforumstmp';this.id = 'visitedforums';showMenu({'ctrlid':this.id,'pos':'21'})"><a href="http://cpp.ra2diy.com/forum-49-1.html">返回列表</a></span>
<a id="newspecialtmp" onmouseover="$('newspecial').id = 'newspecialtmp';this.id = 'newspecial';showMenu({'ctrlid':this.id})" onclick="showWindow('newthread', 'forum.php?mod=post&action=newthread&fid=49')" href="javascript:;" title="发新帖"><img src="https://cpp.ra2diy.com/static/image/common/pn_post.png" alt="发新帖" /></a>
</div>

<!--[diy=diyfastposttop]--><div id="diyfastposttop" class="area"></div><!--[/diy]-->
<script type="text/javascript">
var postminchars = parseInt('0');
var postmaxchars = parseInt('10000');
var disablepostctrl = parseInt('0');
</script>

<div id="f_pst" class="pl bm bmw">
<form method="post" autocomplete="off" id="fastpostform" action="forum.php?mod=post&amp;action=reply&amp;fid=49&amp;tid=17333&amp;extra=page%3D1&amp;replysubmit=yes&amp;infloat=yes&amp;handlekey=fastpost" onSubmit="return fastpostvalidate(this)">
<table cellspacing="0" cellpadding="0">
<tr>
<td class="pls">
</td>
<td class="plc">

<span id="fastpostreturn"></span>


<div class="cl">
<div id="fastsmiliesdiv" class="y"><div id="fastsmiliesdiv_data"><div id="fastsmilies"></div></div></div><div class="hasfsl" id="fastposteditor">
<div class="tedt mtn">
<div class="bar">
<span class="y">
<a href="http://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333" onclick="return switchAdvanceMode(this.href)">高级模式</a>
</span><script src="https://cpp.ra2diy.com/data/cache/seditor.js?W6u" type="text/javascript"></script>
<div class="fpd">
<a href="javascript:;" title="文字加粗" class="fbld">B</a>
<a href="javascript:;" title="设置文字颜色" class="fclr" id="fastpostforecolor">Color</a>
<a id="fastpostimg" href="javascript:;" title="图片" class="fmg">Image</a>
<a id="fastposturl" href="javascript:;" title="添加链接" class="flnk">Link</a>
<a id="fastpostquote" href="javascript:;" title="引用" class="fqt">Quote</a>
<a id="fastpostcode" href="javascript:;" title="代码" class="fcd">Code</a>
<a href="javascript:;" class="fsml" id="fastpostsml">Smilies</a>
</div></div>
<div class="area">
<div class="pt hm">
您需要登录后才可以回帖 <a href="https://cpp.ra2diy.com/member.php?mod=logging&action=login" onclick="showWindow('login', this.href)" class="xi2">登录</a> | <a href="https://cpp.ra2diy.com/member.php?mod=register" class="xi2">立即注册</a>
</div>
</div>
</div>
</div>
</div>
<div id="seccheck_fastpost">
</div>


<input type="hidden" name="formhash" value="babe254c" />
<input type="hidden" name="usesig" value="" />
<input type="hidden" name="subject" value="  " />
<p class="ptm pnpost">
<a href="http://cpp.ra2diy.com/home.php?mod=spacecp&ac=credit&op=rule&fid=49" class="y" target="_blank">本版积分规则</a>
<button type="button" onclick="showWindow('login', 'member.php?mod=logging&action=login&guestmessage=yes')" name="replysubmit" id="fastpostsubmit" class="pn pnc vm" value="replysubmit" tabindex="5"><strong>发表回复</strong></button>
<label for="fastpostrefresh"><input id="fastpostrefresh" type="checkbox" class="pc" />回帖后跳转到最后一页</label>
<script type="text/javascript">if(getcookie('fastpostrefresh') == 1) {$('fastpostrefresh').checked=true;}</script>
</p>
</td>
</tr>
</table>
</form>
</div>

<div id="visitedforums_menu" class="p_pop blk cl" style="display: none;">
<table cellspacing="0" cellpadding="0">
<tr>
<td id="v_forums">
<h3 class="mbn pbn bbda xg1">浏览过的版块</h3>
<ul class="xl xl1">
<li><a href="http://cpp.ra2diy.com/forum-51-1.html">触类旁通</a></li><li><a href="http://cpp.ra2diy.com/forum-44-1.html">集思广益</a></li><li><a href="http://cpp.ra2diy.com/forum-48-1.html">稽古振今</a></li><li><a href="http://cpp.ra2diy.com/forum-42-1.html">答疑解难</a></li><li><a href="http://cpp.ra2diy.com/forum-46-1.html">咬文嚼字</a></li><li><a href="http://cpp.ra2diy.com/forum-38-1.html">公听并观</a></li><li><a href="http://cpp.ra2diy.com/forum-41-1.html">依经傍注</a></li><li><a href="http://cpp.ra2diy.com/forum-2-1.html">规行矩止</a></li></ul>
</td>
</tr>
</table>
</div>
<script type="text/javascript">document.onkeyup = function(e){keyPageScroll(e, 0, 1, 'forum.php?mod=viewthread&tid=17333', 1);}</script>
</div>

<div class="wp mtn">
<!--[diy=diy3]--><div id="diy3" class="area"></div><!--[/diy]-->
</div>

<script type="text/javascript">
function succeedhandle_followmod(url, msg, values) {
var fObj = $('followmod_'+values['fuid']);
if(values['type'] == 'add') {
fObj.innerHTML = '不收听';
fObj.href = 'home.php?mod=spacecp&ac=follow&op=del&fuid='+values['fuid'];
} else if(values['type'] == 'del') {
fObj.innerHTML = '收听TA';
fObj.href = 'home.php?mod=spacecp&ac=follow&op=add&hash=babe254c&fuid='+values['fuid'];
}
}
fixed_avatar([17674,17675,17676,17677,17678,17679,17680,17681,17682,17683,17684,17685,17686,17687,17688,17689,17690,17691,17692,17693,17694,17695,17696,17697,17698,17699,17700,17701,17702,17703], 1);
</script>	</div>
<div id="ft" class="wp cl">
<div id="flk" class="y">
<p>
<a href="http://cpp.ra2diy.com/archiver/" >Archiver</a><span class="pipe">|</span><a href="http://cpp.ra2diy.com/forum.php?mobile=yes" >手机版</a><span class="pipe">|</span><a href="http://cpp.ra2diy.com/forum.php?mod=misc&action=showdarkroom" >小黑屋</a><span class="pipe">|</span><strong><a href="http://cpp.ra2diy.com/" target="_blank">ISO/IEC C++ China Unofficial</a></strong>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?99223174cf4f6782023d1b565e976f37";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</p>
<p class="xs0">
GMT+8, 2021-1-24 21:20<span id="debuginfo">
, Processed in 0.156542 second(s), 22 queries
.
</span>
</p>
</div>
<div id="frt">
<p>Powered by <strong><a href="http://www.discuz.net" target="_blank">Discuz!</a></strong> <em>X3.4</em></p>
<p class="xs0">Copyright &copy; 2001-2020, Tencent Cloud.</p>
</div></div>

<div id="scrolltop">
<span><a href="http://cpp.ra2diy.com/forum.php?mod=post&action=reply&fid=49&tid=17333&extra=page=1&page=1" onclick="showWindow('reply', this.href)" class="replyfast" title="快速回复"><b>快速回复</b></a></span>
<span hidefocus="true"><a title="返回顶部" onclick="window.scrollTo('0','0')" class="scrolltopa" ><b>返回顶部</b></a></span>
<span>
<a href="http://cpp.ra2diy.com/forum-49-1.html" hidefocus="true" class="returnlist" title="返回列表"><b>返回列表</b></a>
</span>
</div>
<script type="text/javascript">_attachEvent(window, 'scroll', function () { showTopLink(); });checkBlind();</script>
</body>
</html>
